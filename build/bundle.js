!function(e){var n={};function i(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=n,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var s in e)i.d(t,s,function(n){return e[n]}.bind(null,s));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i(i.s=30)}([function(e,n){e.exports=require("express")},function(e,n){e.exports=e=>(n,i,t)=>Promise.resolve(e(n,i,t)).catch(t)},function(e,n){e.exports=require("superstruct")},function(e,n,i){const t=i(40).createPool({host:process.env.RDS_HOSTNAME,user:process.env.RDS_USERNAME,password:process.env.RDS_PASSWORD,database:process.env.RDS_DB_NAME,waitForConnections:process.env.DB_WAIT_FOR_CONNECTIONS,connectionLimit:process.env.DB_CONNECTION_LIMIT,queueLimit:process.env.DB_QUEUE_LIMIT});e.exports=t},function(e,n,i){const t=i(16);e.exports=function(e,n,i){return e.session&&e.session.userInfo.userId?i():i(new t("Unauthorized",401))}},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("aws-sdk")},function(e,n){e.exports=require("uuid/v4")},function(e,n,i){var t=i(57);function s(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,t)}return i}function r(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?s(i,!0).forEach((function(n){t(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(i).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}e.exports=class{constructor(e){this.pool=e,this.getAllPublicRecipesForElasticSearchBulkInsert=this.getAllPublicRecipesForElasticSearchBulkInsert.bind(this),this.getPublicRecipeForElasticSearchInsert=this.getPublicRecipeForElasticSearchInsert.bind(this),this.viewAllOfficialRecipes=this.viewAllOfficialRecipes.bind(this),this.viewAllPublicRecipes=this.viewAllPublicRecipes.bind(this),this.viewRecipeById=this.viewRecipeById.bind(this),this.createRecipe=this.createRecipe.bind(this),this.updateRecipe=this.updateRecipe.bind(this),this.deleteRecipe=this.deleteRecipe.bind(this),this.viewAllMyPrivateUserRecipes=this.viewAllMyPrivateUserRecipes.bind(this),this.viewAllMyPublicUserRecipes=this.viewAllMyPublicUserRecipes.bind(this),this.viewMyPrivateUserRecipe=this.viewMyPrivateUserRecipe.bind(this),this.viewMyPublicUserRecipe=this.viewMyPublicUserRecipe.bind(this),this.getInfoToEditMyUserRecipe=this.getInfoToEditMyUserRecipe.bind(this),this.updateMyUserRecipe=this.updateMyUserRecipe.bind(this),this.deleteMyPrivateUserRecipe=this.deleteMyPrivateUserRecipe.bind(this),this.disownMyPublicUserRecipe=this.disownMyPublicUserRecipe.bind(this)}async getAllPublicRecipesForElasticSearchBulkInsert(){try{const e=1,n="\n        SELECT\n          r.recipe_id AS recipeId,\n          u.username AS authorName,\n          rt.recipe_type_name AS recipeTypeName,\n          c.cuisine_name AS cuisineName,\n          r.title AS title,\n          r.description AS description,\n          r.directions AS directions,\n          r.recipe_image AS recipeImage\n        FROM nobsc_recipes r\n        INNER JOIN nobsc_users u ON u.user_id = r.author_id\n        INNER JOIN nobsc_recipe_types rt ON rt.recipe_type_id = r.recipe_type_id\n        INNER JOIN nobsc_cuisines c ON c.cuisine_id = r.cuisine_id\n        WHERE r.owner_id = ?\n      ",i="\n        SELECT m.method_name AS methodName\n        FROM nobsc_methods m\n        INNER JOIN nobsc_recipe_methods rm ON rm.method_id = m.method_id\n        WHERE rm.recipe_id = ?\n      ",t="\n        SELECT e.equipment_name AS equipmentName\n        FROM nobsc_equipment e\n        INNER JOIN nobsc_recipe_equipment re ON re.equipment_id = e.equipment_id\n        WHERE re.recipe_id = ?\n      ",s="\n        SELECT i.ingredient_name AS ingredientName\n        FROM nobsc_ingredients i\n        INNER JOIN nobsc_recipe_ingredients ri ON ri.ingredient_id = i.ingredient_id\n        WHERE ri.recipe_id = ?\n      ",a="\n        SELECT r.title AS subrecipeTitle\n        FROM nobsc_recipes r\n        INNER JOIN nobsc_recipe_subrecipes rs ON rs.subrecipe_id = r.recipe_id\n        WHERE rs.recipe_id = ?\n      ",[c]=await this.pool.execute(n,[e]);let o=[];for(let e of c){const{recipeId:n}=e;let c=[],d=[],p=[],u=[];const[m]=await this.pool.execute(i,[n]),[l]=await this.pool.execute(t,[n]),[I]=await this.pool.execute(s,[n]),[_]=await this.pool.execute(a,[n]);m.forEach(e=>c.push(e.methodName)),l.forEach(e=>d.push(e.equipmentName)),I.forEach(e=>p.push(e.ingredientName)),_.forEach(e=>u.push(e.subrecipeTitle)),o.push({index:{_index:"recipes",_id:n}},r({},e,{},{methodNames:c,equipmentNames:d,ingredientNames:p,subrecipeNames:u}))}return o}catch(e){console.log(e)}}async getPublicRecipeForElasticSearchInsert(e){try{const n=1,i="\n        SELECT\n          r.recipe_id AS recipeId,\n          u.username AS authorName,\n          rt.recipe_type_name AS recipeTypeName,\n          c.cuisine_name AS cuisineName,\n          r.title AS title,\n          r.description AS description,\n          r.directions AS directions,\n          r.recipe_image AS recipeImage\n        FROM nobsc_recipes r\n        INNER JOIN nobsc_users u ON u.user_id = r.author_id\n        INNER JOIN nobsc_recipe_types rt ON rt.recipe_type_id = r.recipe_type_id\n        INNER JOIN nobsc_cuisines c ON c.cuisine_id = r.cuisine_id\n        WHERE r.recipe_id = ? AND r.owner_id = ?\n      ",t="\n        SELECT m.method_name AS methodName\n        FROM nobsc_methods m\n        INNER JOIN nobsc_recipe_methods rm ON rm.method_id = m.method_id\n        WHERE rm.recipe_id = ?\n      ",s="\n        SELECT e.equipment_name AS equipmentName\n        FROM nobsc_equipment e\n        INNER JOIN nobsc_recipe_equipment re ON re.equipment_id = e.equipment_id\n        WHERE re.recipe_id = ?\n      ",a="\n        SELECT i.ingredient_name AS ingredientName\n        FROM nobsc_ingredients i\n        INNER JOIN nobsc_recipe_ingredients ri ON ri.ingredient_id = i.ingredient_id\n        WHERE ri.recipe_id = ?\n      ",c="\n        SELECT r.title AS subrecipeTitle\n        FROM nobsc_recipes r\n        INNER JOIN nobsc_recipe_subrecipes rs ON rs.subrecipe_id = r.recipe_id\n        WHERE rs.recipe_id = ?\n      ",[o]=await this.pool.execute(i,[e,n]),[d]=await this.pool.execute(t,[e]),[p]=await this.pool.execute(s,[e]),[u]=await this.pool.execute(a,[e]),[m]=await this.pool.execute(c,[e]);let l=[],I=[],_=[],y=[];d.forEach(e=>l.push(e.methodName)),p.forEach(e=>I.push(e.equipmentName)),u.forEach(e=>_.push(e.ingredientName)),m.forEach(e=>y.push(e.subrecipeTitle));const[g]=o;return r({},r({},g),{},{methodNames:l,equipmentNames:I,ingredientNames:_,subrecipeNames:y})}catch(e){console.log(e)}}async viewAllOfficialRecipes(){const[e]=await this.pool.execute("\n      SELECT recipe_id, recipe_type_id, cuisine_id, title, recipe_image\n      FROM nobsc_recipes\n      WHERE author_id = 1 AND owner_id = 1\n      ORDER BY title ASC\n    ");return e}async viewAllPublicRecipes(){const[e]=await this.pool.execute("\n      SELECT recipe_id, recipe_type_id, cuisine_id, title, recipe_image\n      FROM nobsc_recipes\n      WHERE author_id != 1 AND owner_id = 1\n    ");return e}async viewRecipeById(e){try{const n=1,i="\n        SELECT\n          r.recipe_id AS recipeId,\n          u.username AS authorName,\n          u.avatar AS authorAvatar,\n          rt.recipe_type_name AS recipeTypeName,\n          c.cuisine_name AS cuisineName,\n          r.title AS title,\n          r.description AS description,\n          r.directions AS directions,\n          r.recipe_image AS recipeImage,\n          r.equipment_image AS recipeEquipmentImage,\n          r.ingredients_image AS recipeIngredientsImage,\n          r.cooking_image AS recipeCookingImage\n        FROM nobsc_recipes r\n        INNER JOIN nobsc_users u ON u.user_id = r.author_id\n        INNER JOIN nobsc_recipe_types rt ON rt.recipe_type_id = r.recipe_type_id\n        INNER JOIN nobsc_cuisines c ON c.cuisine_id = r.cuisine_id\n        WHERE r.recipe_id = ? AND r.owner_id = ?\n      ",t="\n        SELECT m.method_name AS methodName\n        FROM nobsc_methods m\n        INNER JOIN nobsc_recipe_methods rm ON rm.method_id = m.method_id\n        WHERE rm.recipe_id = ?\n      ",s="\n        SELECT\n          re.amount AS amount,\n          e.equipment_name AS equipmentName\n        FROM nobsc_equipment e\n        INNER JOIN nobsc_recipe_equipment re ON re.equipment_id = e.equipment_id\n        WHERE re.recipe_id = ?\n      ",a="\n        SELECT\n          i.ingredient_name AS ingredientName,\n          ri.amount AS amount,\n          m.measurement_name AS measurementName\n        FROM nobsc_ingredients i\n        INNER JOIN nobsc_recipe_ingredients ri ON ri.ingredient_id = i.ingredient_id\n        INNER JOIN nobsc_measurements m ON ri.measurement_id = m.measurement_id\n        WHERE ri.recipe_id = ?\n      ",c="\n        SELECT\n          r.title AS subrecipeTitle,\n          rs.amount AS amount,\n          m.measurement_name AS measurementName\n        FROM nobsc_recipes r\n        INNER JOIN nobsc_recipe_subrecipes rs ON rs.subrecipe_id = r.recipe_id\n        INNER JOIN nobsc_measurements m ON rs.measurement_id = m.measurement_id\n        WHERE rs.recipe_id = ?\n      ",[o]=await this.pool.execute(i,[e,n]),[d]=await this.pool.execute(t,[e]),[p]=await this.pool.execute(s,[e]),[u]=await this.pool.execute(a,[e]),[m]=await this.pool.execute(c,[e]);return r({recipe:o},{requiredMethods:d,requiredEquipment:p,requiredIngredients:u,requiredSubrecipes:m})}catch(e){console.log(e)}}async createRecipe(e){const{recipeTypeId:n,cuisineId:i,authorId:t,ownerId:s,title:r,description:a,directions:c,recipeImage:o,equipmentImage:d,ingredientsImage:p,cookingImage:u}=e,[m]=await this.pool.execute("\n      INSERT INTO nobsc_recipes (\n        recipe_type_id,\n        cuisine_id,\n        author_id,\n        owner_id,\n        title,\n        description,\n        directions,\n        recipe_image,\n        equipment_image,\n        ingredients_image,\n        cooking_image\n      ) VALUES (\n        ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?\n      )\n    ",[n,i,t,s,r,a,c,o,d,p,u]);return m}async updateRecipe(e,n){const{recipeTypeId:i,cuisineId:t,authorId:s,ownerId:r,title:a,description:c,directions:o,recipeImage:d,equipmentImage:p,ingredientsImage:u,cookingImage:m}=e,[l]=await this.pool.execute("\n      UPDATE nobsc_recipes\n      SET\n        recipe_type_id = ?,\n        cuisine_id = ?,\n        author_id = ?,\n        owner_id = ?,\n        title = ?,\n        description = ?,\n        directions = ?,\n        recipe_image = ?,\n        equipment_image = ?,\n        ingredients_image = ?,\n        cooking_image = ?\n      WHERE recipe_id = ?\n      LIMIT 1\n    ",[i,t,s,r,a,c,o,d,p,u,m,n]);return l}async deleteRecipe(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipes\n      WHERE recipe_id = ?\n      LIMIT 1\n    ",[e]);return n}async viewAllMyPrivateUserRecipes(e){const[n]=await this.pool.execute("\n      SELECT recipe_id, recipe_type_id, cuisine_id, title, recipe_image\n      FROM nobsc_recipes\n      WHERE owner_id = ?\n      ORDER BY title ASC\n    ",[e]);return n}async viewAllMyPublicUserRecipes(e,n){const[i]=await this.pool.execute("\n      SELECT recipe_id, recipe_type_id, cuisine_id, title, recipe_image\n      FROM nobsc_recipes\n      WHERE author_id = ? AND owner_id = ?\n      ORDER BY title ASC\n    ",[e,n]);return i}async viewMyPrivateUserRecipe(e,n){const[i]=await this.pool.execute("\n      SELECT\n        r.recipe_id AS recipeId,\n        u.username AS authorName,\n        u.avatar AS authorAvatar,\n        rt.recipe_type_name AS recipeTypeName,\n        c.cuisine_name AS cuisineName,\n        r.title AS title,\n        r.description AS description,\n        r.directions AS directions,\n        r.recipe_image AS recipeImage,\n        r.equipment_image AS recipeEquipmentImage,\n        r.ingredients_image AS recipeIngredientsImage,\n        r.cooking_image AS recipeCookingImage\n      FROM nobsc_recipes r\n      INNER JOIN nobsc_users u ON u.user_id = r.author_id\n      INNER JOIN nobsc_recipe_types rt ON rt.recipe_type_id = r.recipe_type_id\n      INNER JOIN nobsc_cuisines c ON c.cuisine_id = r.cuisine_id\n      WHERE r.recipe_id = ? AND r.owner_id = ?\n    ",[e,n]),[t]=await this.pool.execute("\n      SELECT m.method_name AS methodName\n      FROM nobsc_methods m\n      INNER JOIN nobsc_recipe_methods rm ON rm.method_id = m.method_id\n      WHERE rm.recipe_id = ?\n    ",[e]),[s]=await this.pool.execute("\n      SELECT\n        re.amount AS amount,\n        e.equipment_name AS equipmentName\n      FROM nobsc_equipment e\n      INNER JOIN nobsc_recipe_equipment re ON re.equipment_id = e.equipment_id\n      WHERE re.recipe_id = ?\n    ",[e]),[a]=await this.pool.execute("\n      SELECT\n        i.ingredient_name AS ingredientName,\n        ri.amount AS amount,\n        m.measurement_name AS measurementName\n      FROM nobsc_ingredients i\n      INNER JOIN nobsc_recipe_ingredients ri ON ri.ingredient_id = i.ingredient_id\n      INNER JOIN nobsc_measurements m ON ri.measurement_id = m.measurement_id\n      WHERE ri.recipe_id = ?\n    ",[e]),[c]=await this.pool.execute("\n      SELECT\n        r.title AS subrecipeTitle,\n        rs.amount AS amount,\n        m.measurement_name AS measurementName\n      FROM nobsc_recipes r\n      INNER JOIN nobsc_recipe_subrecipes rs ON rs.subrecipe_id = r.recipe_id\n      INNER JOIN nobsc_measurements m ON rs.measurement_id = m.measurement_id\n      WHERE rs.recipe_id = ?\n    ",[e]);return r({recipe:i},{requiredMethods:t,requiredEquipment:s,requiredIngredients:a,requiredSubrecipes:c})}async viewMyPublicUserRecipe(e,n,i){const[t]=await this.pool.execute("\n      SELECT\n        r.recipe_id,\n        rt.recipe_type_name,\n        c.cuisine_name,\n        u.username AS author,\n        u.username AS owner,\n        r.title,\n        r.description,\n        r.directions,\n        md.method_name,\n        re.amount,\n        e.equipment_name,\n        ri.amount,\n        m.measurement_name AS ingredient_unit,\n        e.ingredient_name,\n        rs.amount,\n        m.measurement_name AS subrecipe_unit,\n        r.title AS subtitle,\n        r.recipe_image,\n        r.equipment_image,\n        r.ingredients_image,\n        r.cooking_image\n      FROM nobsc_recipes r\n      INNER JOIN nobsc_recipe_types rt ON rt.recipe_type_id = r.recipe_type_id\n      INNER JOIN nobsc_cuisines c ON c.cuisine_id = r.cuisine_id\n      INNER JOIN nobsc_users u ON u.user_id = r.author_id\n      INNER JOIN nobsc_user u ON u.user_id = r.owner_id\n      INNER JOIN nobsc_recipe_methods rmd ON rmd.recipe_id = r.recipe_id\n      INNER JOIN nobsc_recipe_methods rmd ON rmd.method_id = md.method_id \n      INNER JOIN nobsc_recipe_equipment re ON re.recipe_id = r.recipe_id\n      INNER JOIN nobsc_recipe_equipment re ON re.equipment_id = e.equipment_id\n      INNER JOIN nobsc_recipe_ingredients ri ON ri.recipe_id = r.recipe_id\n      INNER JOIN nobsc_recipe_ingredients ri ON ri.measurement_id = m.measurement_id\n      INNER JOIN nobsc_recipe_ingredients ri ON ri.ingredient_id = i.ingredient_id\n      INNER JOIN nobsc_recipe_subrecipes rs ON rs.recipe_id = r.recipe_id\n      INNER JOIN nobsc_recipe_subrecipes rs ON rs.measurement_id = m.measurement_id\n      INNER JOIN nobsc_recipe_subrecipes rs ON rs.subrecipe_id = r.recipe_id\n      WHERE r.recipe_id = ? AND r.author_id = ? AND r.owner_id = ?\n    ",[e,n,i]);return t}async getInfoToEditMyUserRecipe(e,n,i){const[t]=await this.pool.execute("\n      SELECT\n        r.recipe_id AS recipeId,\n        r.recipe_type_id AS recipeTypeId,\n        r.cuisine_id AS cuisineId,\n        r.owner_id AS ownerId,\n        r.title AS title,\n        r.description AS description,\n        r.directions AS directions,\n        r.recipe_image AS recipeImage,\n        r.equipment_image AS recipeEquipmentImage,\n        r.ingredients_image AS recipeIngredientsImage,\n        r.cooking_image AS recipeCookingImage\n      FROM nobsc_recipes r\n      WHERE r.recipe_id = ? AND r.author_id = ? AND r.owner_id = ?\n    ",[e,n,i]),[s]=await this.pool.execute("\n      SELECT method_id AS methodId\n      FROM nobsc_recipe_methods\n      WHERE recipe_id = ?\n    ",[e]),[r]=await this.pool.execute("\n      SELECT\n        re.amount AS amount,\n        e.equipment_type_id AS equipmentTypeId,\n        re.equipment_id AS equipmentId\n      FROM nobsc_equipment e\n      INNER JOIN nobsc_recipe_equipment re ON re.equipment_id = e.equipment_id\n      WHERE re.recipe_id = ?\n    ",[e]),[a]=await this.pool.execute("\n      SELECT\n        ri.amount AS amount,\n        ri.measurement_id AS measurementId,\n        i.ingredient_type_id AS ingredientTypeId,\n        ri.ingredient_id AS ingredientId\n      FROM nobsc_ingredients i\n      INNER JOIN nobsc_recipe_ingredients ri ON ri.ingredient_id = i.ingredient_id\n      WHERE ri.recipe_id = ?\n    ",[e]),[c]=await this.pool.execute("\n      SELECT\n        rs.amount AS amount,\n        rs.measurement_id AS measurementId,\n        r.recipe_type_id AS recipeTypeId,\n        r.cuisine_id AS cuisineId,\n        rs.subrecipe_id AS subrecipeId\n      FROM nobsc_recipes r\n      INNER JOIN nobsc_recipe_subrecipes rs ON rs.subrecipe_id = r.recipe_id\n      WHERE rs.recipe_id = ?\n    ",[e]);return{recipe:t[0],requiredMethods:s,requiredEquipment:r,requiredIngredients:a,requiredSubrecipes:c}}async updateMyUserRecipe(e,n){const{recipeTypeId:i,cuisineId:t,authorId:s,ownerId:r,title:a,description:c,directions:o,recipeImage:d,equipmentImage:p,ingredientsImage:u,cookingImage:m}=e,[l]=await this.pool.execute("\n      UPDATE nobsc_recipes\n      SET\n        recipe_type_id = ?,\n        cuisine_id = ?,\n        title = ?,\n        description = ?,\n        directions = ?,\n        recipe_image = ?,\n        equipment_image = ?,\n        ingredients_image = ?,\n        cooking_image = ?\n      WHERE recipe_id = ? AND author_id = ? AND owner_id = ?\n      LIMIT 1\n    ",[i,t,a,c,o,d,p,u,m,n,s,r]);return l}async deleteMyPrivateUserRecipe(e,n,i){const[t]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipes\n      WHERE recipe_id = ? AND author_id = ? AND owner_id = ?\n      LIMIT 1\n    ",[e,n,i]);return t}async disownMyPublicUserRecipe(e,n,i){const[t]=await this.pool.execute("\n      UPDATE nobsc_recipes\n      SET author_id = ?\n      WHERE recipe_id = ? AND author_id = ? AND owner_id = 1\n      LIMIT 1\n    ",[e,n,i]);return t}}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.deleteAllFavoritesOfRecipe=this.deleteAllFavoritesOfRecipe.bind(this),this.viewMyFavoriteRecipes=this.viewMyFavoriteRecipes.bind(this),this.createMyFavoriteRecipe=this.createMyFavoriteRecipe.bind(this),this.deleteMyFavoriteRecipe=this.deleteMyFavoriteRecipe.bind(this)}async deleteAllFavoritesOfRecipe(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_favorite_recipes\n      WHERE recipe_id = ?\n    ",[e]);return n}async viewMyFavoriteRecipes(e){const[n]=await this.pool.execute("\n      SELECT \n        f.recipe_id AS recipe_id,\n        r.title AS title,\n        r.recipe_image AS recipe_image\n      FROM nobsc_favorite_recipes f\n      INNER JOIN nobsc_recipes r ON r.recipe_id = f.recipe_id\n      WHERE f.user_id = ?\n      ORDER BY title\n    ",[e]);return n}async createMyFavoriteRecipe(e,n){const[i]=await this.pool.execute("\n      INSERT INTO nobsc_favorite_recipes (user_id, recipe_id)\n      VALUES (?, ?)\n    ",[e,n]);return i}async deleteMyFavoriteRecipe(e,n){const[i]=await this.pool.execute("\n      DELETE\n      FROM nobsc_favorite_recipes\n      WHERE user_id = ? AND recipe_id = ?\n      LIMIT 1\n    ",[e,n]);return i}}},function(e,n,i){const t=i(16);e.exports=function(e,n,i){return e.session&&e.session.staffInfo.staffId?i():i(new t("Unauthorized",401))}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.getAllPublicEquipmentForElasticSearchBulkInsert=this.getAllPublicEquipmentForElasticSearchBulkInsert.bind(this),this.countAllEquipment=this.countAllEquipment.bind(this),this.countEquipmentOfType=this.countEquipmentOfType.bind(this),this.countEquipmentOfTypes=this.countEquipmentOfTypes.bind(this),this.viewAllEquipment=this.viewAllEquipment.bind(this),this.viewEquipmentOfType=this.viewEquipmentOfType.bind(this),this.viewEquipmentOfTypes=this.viewEquipmentOfTypes.bind(this),this.viewAllOfficialEquipment=this.viewAllOfficialEquipment.bind(this),this.viewEquipmentById=this.viewEquipmentById.bind(this),this.createEquipment=this.createEquipment.bind(this),this.updateEquipment=this.updateEquipment.bind(this),this.deleteEquipment=this.deleteEquipment.bind(this),this.viewAllMyPrivateUserEquipment=this.viewAllMyPrivateUserEquipment.bind(this),this.viewMyPrivateUserEquipment=this.viewMyPrivateUserEquipment.bind(this),this.createMyPrivateUserEquipment=this.createMyPrivateUserEquipment.bind(this),this.updateMyPrivateUserEquipment=this.updateMyPrivateUserEquipment.bind(this),this.deleteMyPrivateUserEquipment=this.deleteMyPrivateUserEquipment.bind(this)}async getAllPublicEquipmentForElasticSearchBulkInsert(){try{const e=1,n="\n        SELECT\n          e.equipment_id AS equipmentId,\n          et.equipment_type_name AS equipmentTypeName,\n          e.equipment_name AS equipmentName,\n          e.equipment_image AS equipmentImage\n        FROM nobsc_equipment e\n        INNER JOIN nobsc_equipment_types et ON et.equipment_type_id = e.equipment_type_id\n        WHERE e.owner_id = ?\n      ",[i]=await this.pool.execute(n,[e]);let t=[];for(let e of i){const{equipmentId:n}=e;t.push({index:{_index:"equipment",_id:n}},e)}return t}catch(e){console.log(e)}}async countAllEquipment(){const[e]=await this.pool.execute("\n      SELECT COUNT(*) AS total\n      FROM nobsc_equipment\n      WHERE owner_id = 1\n    ");return e}async countEquipmentOfType(e){const[n]=await this.pool.execute("\n      SELECT COUNT(*) AS total\n      FROM nobsc_equipment\n      WHERE equipment_type_id = ? AND owner_id = 1\n    ",[e]);return n}async countEquipmentOfTypes(e,n){const i=`\n      SELECT COUNT(*) AS total\n      FROM nobsc_equipment\n      WHERE equipment_type_id IN (${e}) AND owner_id = 1\n    `,[t]=await this.pool.execute(i,n);return t}async viewAllEquipment(e,n){const[i]=await this.pool.execute("\n      SELECT equipment_id, equipment_name, equipment_type_id, equipment_image\n      FROM nobsc_equipment\n      WHERE owner_id = 1\n      ORDER BY equipment_name ASC\n      LIMIT ?, ?\n    ",[e,n]);return i}async viewEquipmentOfType(e,n,i){const[t]=await this.pool.execute("\n      SELECT equipment_id, equipment_name, equipment_type_id, equipment_image\n      FROM nobsc_equipment\n      WHERE equipment_type_id = ? AND owner_id = 1\n      ORDER BY equipment_name ASC\n      LIMIT ?, ?\n    ",[i,e,n]);return t}async viewEquipmentOfTypes(e,n,i,t){const s=`\n      SELECT equipment_id, equipment_name, equipment_type_id, equipment_image\n      FROM nobsc_equipment\n      WHERE equipment_type_id IN (${i}) AND owner_id = 1\n      ORDER BY equipment_name ASC\n      LIMIT ${e}, ${n}\n    `,[r]=await this.pool.execute(s,t);return r}async viewAllOfficialEquipment(){const[e]=await this.pool.execute("\n      SELECT equipment_id, equipment_type_id, equipment_name, equipment_image\n      FROM nobsc_equipment\n      WHERE owner_id = 1\n      ORDER BY equipment_name ASC\n    ");return e}async viewEquipmentById(e){const[n]=await this.pool.execute("\n      SELECT\n        e.equipment_id AS equipment_id,\n        t.equipment_type_name AS equipment_type_name\n        e.equipment_name AS equipment_name,\n        e.equipment_description AS equipment_description\n        e.equipment_image AS equipment_image\n      FROM nobsc_equipment e\n      INNER JOIN nobsc_equipment_types t ON e.equipment_type_id = t.equipment_type_id\n      WHERE owner_id = 1 AND equipment_id = ?\n    ",[e]);return n}async createEquipment(e){const{equipmentTypeId:n,authorId:i,ownerId:t,equipmentName:s,equipmentDescription:r,equipmentImage:a}=e,[c]=await this.pool.execute("\n      INSERT INTO nobsc_equipment\n      (equipment_type_id, author_id, owner_id, equipment_name, equipment_description, equipment_image) \n      VALUES (?, ?, ?, ?, ?, ?)\n    ",[n,i,t,s,r,a]);return c}async updateEquipment(e,n){const{equipmentTypeId:i,equipmentName:t,equipmentDescription:s,equipmentImage:r}=e,[a]=await this.pool.execute("\n      UPDATE nobsc_equipment\n      SET\n        equipment_type_id = ?,\n        equipment_name = ?,\n        equipment_description = ?,\n        equipment_image = ?\n      WHERE equipment_id = ?\n      LIMIT 1\n    ",[i,t,s,r,n]);return a}async deleteEquipment(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_equipment\n      WHERE equipment_id = ?\n      LIMIT 1\n    ",[e]);return n}async viewAllMyPrivateUserEquipment(e){const[n]=await this.pool.execute("\n      SELECT equipment_id, equipment_type_id, equipment_name, equipment_image, equipment_description\n      FROM nobsc_equipment\n      WHERE owner_id = ?\n      ORDER BY equipment_name ASC\n    ",[e]);return n}async viewMyPrivateUserEquipment(e,n){const[i]=await this.pool.execute("\n      SELECT\n        e.equipment_id AS equipment_id,\n        t.equipment_type_name AS equipment_type_name\n        e.equipment_name AS equipment_name,\n        e.equipment_description AS equipment_description\n        e.equipment_image AS equipment_image\n      FROM nobsc_equipment e\n      INNER JOIN nobsc_equipment_types t ON e.equipment_type_id = t.equipment_type_id\n      WHERE owner_id = ? AND equipment_id = ?\n    ",[e,n]);return i}async createMyPrivateUserEquipment(e){const{equipmentTypeId:n,authorId:i,ownerId:t,equipmentName:s,equipmentDescription:r,equipmentImage:a}=e,[c]=await this.pool.execute("\n      INSERT INTO nobsc_equipment\n      (equipment_type_id, author_id, owner_id, equipment_name, equipment_description, equipment_image)\n      VALUES\n      (?, ?, ?, ?, ?, ?)\n    ",[n,i,t,s,r,a]);return c}async updateMyPrivateUserEquipment(e,n){const{equipmentTypeId:i,authorId:t,ownerId:s,equipmentName:r,equipmentDescription:a,equipmentImage:c}=e,[o]=await this.pool.execute("\n      UPDATE nobsc_equipment\n      SET\n        equipment_type_id = ?,\n        author_id = ?,\n        owner_id = ?,\n        equipment_name = ?,\n        equipment_description = ?,\n        equipment_image = ?\n      WHERE owner_id = ? AND equipment_id = ?\n      LIMIT 1\n    ",[i,t,s,r,a,c,s,n]);return o}async deleteMyPrivateUserEquipment(e,n){const[i]=await this.pool.execute("\n      DELETE\n      FROM nobsc_equipment\n      WHERE owner_id = ? AND equipment_id = ?\n      LIMIT 1\n    ",[e,n]);return i}}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.getAllPublicIngredientsForElasticSearchBulkInsert=this.getAllPublicIngredientsForElasticSearchBulkInsert.bind(this),this.countAllIngredients=this.countAllIngredients.bind(this),this.countIngredientsOfType=this.countIngredientsOfType.bind(this),this.countIngredientsOfTypes=this.countIngredientsOfTypes.bind(this),this.viewAllIngredients=this.viewAllIngredients.bind(this),this.viewIngredientsOfType=this.viewIngredientsOfType.bind(this),this.viewIngredientsOfTypes=this.viewIngredientsOfTypes.bind(this),this.viewAllOfficialIngredients=this.viewAllOfficialIngredients.bind(this),this.viewIngredientById=this.viewIngredientById.bind(this),this.createIngredient=this.createIngredient.bind(this),this.updateIngredient=this.updateIngredient.bind(this),this.deleteIngredient=this.deleteIngredient.bind(this),this.viewAllMyPrivateUserIngredients=this.viewAllMyPrivateUserIngredients.bind(this),this.viewMyPrivateUserIngredient=this.viewMyPrivateUserIngredient.bind(this),this.createMyPrivateUserIngredient=this.createMyPrivateUserIngredient.bind(this),this.updateMyPrivateUserIngredient=this.updateMyPrivateUserIngredient.bind(this),this.deleteMyPrivateUserIngredient=this.deleteMyPrivateUserIngredient.bind(this)}async getAllPublicIngredientsForElasticSearchBulkInsert(){try{const e=1,n="\n        SELECT\n          i.ingredient_id AS ingredientId,\n          it.ingredient_type_name AS ingredientTypeName,\n          i.ingredient_name AS ingredientName,\n          i.ingredient_image AS ingredientImage\n        FROM nobsc_ingredients i\n        INNER JOIN nobsc_ingredient_types it ON it.ingredient_type_id = i.ingredient_type_id\n        WHERE i.owner_id = ?\n      ",[i]=await this.pool.execute(n,[e]);let t=[];for(let e of i){const{ingredientId:n}=e;t.push({index:{_index:"ingredients",_id:n}},e)}return t}catch(e){console.log(e)}}async countAllIngredients(){const[e]=await this.pool.execute("\n      SELECT COUNT(*) AS total\n      FROM nobsc_ingredients\n    ");return e}async countIngredientsOfType(e){const[n]=await this.pool.execute("\n      SELECT COUNT(*) AS total\n      FROM nobsc_ingredients\n      WHERE ingredient_type_id = ?\n    ",[e]);return n}async countIngredientsOfTypes(e,n){const i=`\n      SELECT COUNT(*) AS total\n      FROM nobsc_ingredients\n      WHERE ingredient_type_id IN (${e})\n    `,[t]=await this.pool.execute(i,n);return t}async viewAllIngredients(e,n){const[i]=await this.pool.execute("\n      SELECT ingredient_id, ingredient_name, ingredient_type_id, ingredient_image\n      FROM nobsc_ingredients\n      ORDER BY ingredient_name ASC\n      LIMIT ?, ?\n    ",[e,n]);return i}async viewIngredientsOfType(e,n,i){const[t]=await this.pool.execute("\n      SELECT ingredient_id, ingredient_name, ingredient_type_id, ingredient_image\n      FROM nobsc_ingredients\n      WHERE ingredient_type_id = ?\n      ORDER BY ingredient_name ASC\n      LIMIT ?, ?\n    ",[i,e,n]);return t}async viewIngredientsOfTypes(e,n,i,t){const s=`\n      SELECT ingredient_id, ingredient_name, ingredient_type_id, ingredient_image\n      FROM nobsc_ingredients\n      WHERE ingredient_type_id IN (${i})\n      ORDER BY ingredient_name ASC\n      LIMIT ${e}, ${n}\n    `,[r]=await this.pool.execute(s,t);return r}async viewAllOfficialIngredients(){const[e]=await this.pool.execute("\n      SELECT ingredient_id, ingredient_type_id, ingredient_name, ingredient_image\n      FROM nobsc_ingredients\n      WHERE owner_id = 1\n      ORDER BY ingredient_name ASC\n    ");return e}async viewIngredientById(e){const[n]=await this.pool.execute("\n      SELECT\n        i.ingredient_id AS ingredient_id,\n        t.ingredient_type_name AS ingredient_type_name\n        i.ingredient_name AS ingredient_name,\n        i.ingredient_description AS ingredient_description,\n        i.ingredient_image AS ingredient_image\n      FROM nobsc_ingredients i\n      INNER JOIN nobsc_ingredient_types t ON i.ingredient_type_id = t.ingredient_type_id\n      WHERE owner_id = 1 AND ingredient_id = ?\n    ",[e]);return n}async createIngredient(e){const{ingredientTypeId:n,authorId:i,ownerId:t,ingredientName:s,ingredientDescription:r,ingredientImage:a}=e,[c]=await this.pool.execute("\n      INSERT INTO nobsc_ingredients\n      (ingredient_type_id, author_id, owner_id, ingredient_name, ingredient_description, ingredient_image)\n      VALUES\n      (?, ?, ?, ?, ?, ?)\n    ",[n,i,t,s,r,a]);return c}async updateIngredient(e,n){const{ingredientTypeId:i,ingredientName:t,ingredientDescription:s,ingredientImage:r}=e,[a]=await this.pool.execute("\n      UPDATE nobsc_ingredients\n      SET\n        ingredient_type_id = ?,\n        ingredient_name = ?,\n        ingredient_description = ?,\n        ingredient_image = ?\n      WHERE ingredient_id = ?\n      LIMIT 1\n    ",[i,t,s,r,n]);return a}async deleteIngredient(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_ingredients\n      WHERE ingredient_id = ?\n      LIMIT 1\n    ",[e]);return n}async viewAllMyPrivateUserIngredients(e){const[n]=await this.pool.execute("\n      SELECT ingredient_id, ingredient_type_id, ingredient_name, ingredient_image, ingredient_description\n      FROM nobsc_ingredients\n      WHERE owner_id = ?\n      ORDER BY ingredient_name ASC\n    ",[e]);return n}async viewMyPrivateUserIngredient(e,n){const[i]=await this.pool.execute("\n      SELECT\n        i.ingredient_id AS ingredient_id,\n        t.ingredient_type_name AS ingredient_type_name\n        i.ingredient_name AS ingredient_name,\n        i.ingredient_description AS ingredient_description,\n        i.ingredient_image AS ingredient_image\n      FROM nobsc_ingredients i\n      INNER JOIN nobsc_ingredient_types t ON i.ingredient_type_id = t.ingredient_type_id\n      WHERE owner_id = ? AND ingredient_id = ?\n    ",[e,n]);return i}async createMyPrivateUserIngredient(e){const{ingredientTypeId:n,authorId:i,ownerId:t,ingredientName:s,ingredientDescription:r,ingredientImage:a}=e,[c]=await this.pool.execute("\n      INSERT INTO nobsc_ingredients\n      (ingredient_type_id, author_id, owner_id, ingredient_name, ingredient_description, ingredient_image)\n      VALUES\n      (?, ?, ?, ?, ?, ?)\n    ",[n,i,t,s,r,a]);return c}async updateMyPrivateUserIngredient(e,n){const{ingredientTypeId:i,authorId:t,ownerId:s,ingredientName:r,ingredientDescription:a,ingredientImage:c}=e,[o]=await this.pool.execute("\n      UPDATE nobsc_ingredients\n      SET\n        ingredient_type_id = ?,\n        author_id = ?,\n        owner_id = ?,\n        ingredient_name = ?,\n        ingredient_description = ?,\n        ingredient_image = ?\n      WHERE owner_id = ? AND ingredient_id = ?\n      LIMIT 1\n    ",[i,t,s,r,a,c,s,n]);return o}async deleteMyPrivateUserIngredient(e,n){const[i]=await this.pool.execute("\n      DELETE\n      FROM nobsc_ingredients\n      WHERE owner_id = ? AND ingredient_id = ?\n      LIMIT 1\n    ",[e,n]);return i}}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewRecipeEquipmentByRecipeId=this.viewRecipeEquipmentByRecipeId.bind(this),this.createRecipeEquipment=this.createRecipeEquipment.bind(this),this.updateRecipeEquipment=this.updateRecipeEquipment.bind(this),this.deleteRecipeEquipment=this.deleteRecipeEquipment.bind(this),this.deleteRecipeEquipmentByEquipmentId=this.deleteRecipeEquipmentByEquipmentId.bind(this)}async viewRecipeEquipmentByRecipeId(e){const[n]=await this.pool.execute("\n      SELECT re.amount, e.equipment_name\n      FROM nobsc_recipe_equipment re\n      INNER JOIN nobsc_equipment e ON e.equipment_id = re.equipment_id\n      WHERE re.recipe_id = ?\n      ORDER BY e.equipment_type_id\n    ",[e]);return n}async createRecipeEquipment(e,n){const i=`\n      INSERT INTO nobsc_recipe_equipment (recipe_id, equipment_id, amount)\n      VALUES ${n} \n    `,[t]=await this.pool.execute(i,e);return t}async updateRecipeEquipment(e,n,i){const t="none"!==e?`\n      INSERT INTO nobsc_recipe_equipment (recipe_id, equipment_id, amount)\n      VALUES ${n} \n    `:"none",s=await this.pool.getConnection();await s.beginTransaction();try{if(await s.query("\n      DELETE\n      FROM nobsc_recipe_equipment\n      WHERE recipe_id = ?\n    ",[i]),"none"!==t){const[n]=await s.query(t,e);return await s.commit(),n}await s.commit()}catch(e){throw await s.rollback(),e}finally{s.release()}}async deleteRecipeEquipment(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipe_equipment\n      WHERE recipe_id = ?\n    ",[e]);return n}async deleteRecipeEquipmentByEquipmentId(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipe_equipment\n      WHERE equipment_id = ?\n    ",[e]);return n}}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewRecipeIngredientsByRecipeId=this.viewRecipeIngredientsByRecipeId.bind(this),this.createRecipeIngredients=this.createRecipeIngredients.bind(this),this.updateRecipeIngredients=this.updateRecipeIngredients.bind(this),this.deleteRecipeIngredients=this.deleteRecipeIngredients.bind(this),this.deleteRecipeIngredientsByIngredientId=this.deleteRecipeIngredientsByIngredientId.bind(this)}async viewRecipeIngredientsByRecipeId(e){const[n]=await this.pool.execute("\n      SELECT ri.amount, m.measurement_name, i.ingredient_name\n      FROM nobsc_recipe_ingredients ri\n      INNER JOIN nobsc_measurements m ON m.measurement_id = ri.measurement_id\n      INNER JOIN nobsc_ingredients i ON i.ingredient_id = ri.ingredient_id\n      WHERE ri.recipe_id = ?\n      ORDER BY i.ingredient_type_id\n    ",[e]);return n}async createRecipeIngredients(e,n){const i=`\n      INSERT INTO nobsc_recipe_ingredients (recipe_id, ingredient_id, amount, measurement_id)\n      VALUES ${n}\n    `,[t]=await this.pool.execute(i,e);return t}async updateRecipeIngredients(e,n,i){const t="none"!==e?`\n      INSERT INTO nobsc_recipe_ingredients (recipe_id, ingredient_id, amount, measurement_id)\n      VALUES ${n} \n    `:"none",s=await this.pool.getConnection();await s.beginTransaction();try{if(await s.query("\n      DELETE\n      FROM nobsc_recipe_ingredients\n      WHERE recipe_id = ?\n    ",[i]),"none"!==t){const[n]=await s.query(t,e);return await s.commit(),n}await s.commit()}catch(e){throw await s.rollback(),e}finally{s.release()}}async deleteRecipeIngredients(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipe_ingredients\n      WHERE recipe_id = ?\n    ",[e]);return n}async deleteRecipeIngredientsByIngredientId(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipe_ingredients\n      WHERE ingredient_id = ?\n    ",[e]);return n}}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.getUserByEmail=this.getUserByEmail.bind(this),this.getUserByName=this.getUserByName.bind(this),this.getUserIdByUsername=this.getUserIdByUsername.bind(this),this.viewAllUsers=this.viewAllUsers.bind(this),this.viewUserById=this.viewUserById.bind(this),this.createUser=this.createUser.bind(this),this.setAvatar=this.setAvatar.bind(this)}async getUserByEmail(e){const[n]=await this.pool.execute("\n      SELECT user_id, email, pass, username, avatar\n      FROM nobsc_users\n      WHERE email = ?\n    ",[e]);return n}async getUserByName(e){const[n]=await this.pool.execute("\n      SELECT user_id, email, pass, username\n      FROM nobsc_users\n      WHERE username = ?\n    ",[e]);return n}async getUserIdByUsername(e){const[n]=await this.pool.execute("\n      SELECT user_id, avatar\n      FROM nobsc_users\n      WHERE username = ?\n    ",[e]);return n}async viewAllUsers(e,n){const[i]=await this.pool.execute("\n      SELECT username, avatar\n      FROM nobsc_users\n      ORDER BY username ASC\n      LIMIT ?, ?\n    ",[e,n]);if(!i)throw new Error("viewAllUsers failed");return i}async viewUserById(e){const[n]=await this.pool.execute("\n      SELECT username, avatar\n      FROM nobsc_users\n      WHERE user_id = ?\n    ",[e]);if(!n)throw new Error("viewUserById failed");return n}async createUser(e){const{email:n,pass:i,username:t}=e,[s]=await this.pool.execute("\n      INSERT INTO nobsc_users (email, pass, username)\n      VALUES (?, ?, ?)\n    ",[n,i,t]);if(!s)throw new Error("createUser failed");return s}async setAvatar(e,n){const[i]=await this.pool.execute("\n      UPDATE nobsc_users\n      SET avatar = ?\n      WHERE user_id = ?\n      LIMIT 1\n    ",[e,n]);return i}}},function(e,n){class i extends Error{constructor(e,n){super(e),this.status=n}}e.exports=i},function(e,n){e.exports=require("bcrypt")},function(e,n,i){const{struct:t}=i(2),s=t({equipmentTypeId:"number",authorId:"number",ownerId:"number",equipmentName:"string",equipmentDescription:"string",equipmentImage:"string"},{equipmentImage:"nobsc-equipment-default"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({ingredientTypeId:"number",authorId:"number",ownerId:"number",ingredientName:"string",ingredientDescription:"string",ingredientImage:"string"},{ingredientImage:"nobsc-ingredient-default"});e.exports=s},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewRecipeMethodsByRecipeId=this.viewRecipeMethodsByRecipeId.bind(this),this.createRecipeMethods=this.createRecipeMethods.bind(this),this.updateRecipeMethods=this.updateRecipeMethods.bind(this),this.deleteRecipeMethods=this.deleteRecipeMethods.bind(this)}async viewRecipeMethodsByRecipeId(e){const[n]=await this.pool.execute("\n      SELECT m.method_name\n      FROM nobsc_recipe_methods rm\n      INNER JOIN nobsc_methods m ON m.method_id = rm.method_id\n      WHERE rm.recipe_id = ?\n      ORDER BY m.method_id\n    ",[e]);return n}async createRecipeMethods(e,n){const i=`\n      INSERT INTO nobsc_recipe_methods (recipe_id, method_id)\n      VALUES ${n} \n    `,[t]=await this.pool.execute(i,e);return t}async updateRecipeMethods(e,n,i){const t="none"!==e?`\n      INSERT INTO nobsc_recipe_methods (recipe_id, method_id)\n      VALUES ${n} \n    `:"none",s=await this.pool.getConnection();await s.beginTransaction();try{if(await s.query("\n      DELETE\n      FROM nobsc_recipe_methods\n      WHERE recipe_id = ?\n    ",[i]),"none"!==t){const[n]=await s.query(t,e);return await s.commit(),n}await s.commit()}catch(e){throw await s.rollback(),e}finally{s.release()}}async deleteRecipeMethods(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipe_methods\n      WHERE recipe_id = ?\n    ",[e]);return n}}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewRecipeSubrecipesByRecipeId=this.viewRecipeSubrecipesByRecipeId.bind(this),this.createRecipeSubrecipes=this.createRecipeSubrecipes.bind(this),this.updateRecipeSubrecipes=this.updateRecipeSubrecipes.bind(this),this.deleteRecipeSubrecipes=this.deleteRecipeSubrecipes.bind(this),this.deleteRecipeSubrecipesBySubrecipeId=this.deleteRecipeSubrecipesBySubrecipeId.bind(this)}async viewRecipeSubrecipesByRecipeId(e){const[n]=await this.pool.execute("\n      SELECT rs.amount, m.measurement_name, r.title\n      FROM nobsc_recipe_subrecipes rs\n      INNER JOIN nobsc_measurements m ON m.measurement_id = rs.measurement_id\n      INNER JOIN nobsc_recipes r ON r.recipe_id = rs.subrecipe_id\n      WHERE rs.recipe_id = ?\n      ORDER BY r.recipe_type_id\n    ",[e]);return n}async createRecipeSubrecipes(e,n){const i=`\n      INSERT INTO nobsc_recipe_subrecipes (recipe_id, subrecipe_id, amount, measurement_id)\n      VALUES ${n}\n    `,[t]=await this.pool.execute(i,e);return t}async updateRecipeSubrecipes(e,n,i){const t="none"!==e?`\n      INSERT INTO nobsc_recipe_subrecipes (recipe_id, subrecipe_id, amount, measurement_id)\n      VALUES ${n} \n    `:"none",s=await this.pool.getConnection();await s.beginTransaction();try{if(await s.query("\n      DELETE\n      FROM nobsc_recipe_subrecipes\n      WHERE recipe_id = ?\n    ",[i]),"none"!==t){const[n]=await s.query(t,e);return await s.commit(),n}await s.commit()}catch(e){throw await s.rollback(),e}finally{s.release()}}async deleteRecipeSubrecipes(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipe_subrecipes\n      WHERE recipe_id = ?\n    ",[e]);return n}async deleteRecipeSubrecipesBySubrecipeId(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_recipe_subrecipes\n      WHERE subrecipe_id = ?\n    ",[e]);return n}}},function(e,n){e.exports=class{constructor(e){this.pool=e,this.deleteAllSavesOfRecipe=this.deleteAllSavesOfRecipe.bind(this),this.viewMySavedRecipes=this.viewMySavedRecipes.bind(this),this.createMySavedRecipe=this.createMySavedRecipe.bind(this),this.deleteMySavedRecipe=this.deleteMySavedRecipe.bind(this)}async deleteAllSavesOfRecipe(e){const[n]=await this.pool.execute("\n      DELETE\n      FROM nobsc_saved_recipes\n      WHERE recipe_id = ?\n    ",[e]);return n}async viewMySavedRecipes(e){const[n]=await this.pool.execute("\n      SELECT \n        s.recipe_id AS recipe_id,\n        r.title AS title,\n        r.recipe_image AS recipe_image\n      FROM nobsc_saved_recipes s\n      INNER JOIN nobsc_recipes r ON r.recipe_id = s.recipe_id\n      WHERE user_id = ?\n      ORDER BY title\n    ",[e]);return n}async createMySavedRecipe(e,n){const[i]=await this.pool.execute("\n      INSERT INTO nobsc_saved_recipes (user_id, recipe_id)\n      VALUES (?, ?)\n    ",[e,n]);return i}async deleteMySavedRecipe(e,n){const[i]=await this.pool.execute("\n      DELETE\n      FROM nobsc_saved_recipes\n      WHERE user_id = ? AND recipe_id = ?\n      LIMIT 1\n    ",[e,n]);return i}}},function(e,n,i){const{struct:t}=i(2),s=t({recipeTypeId:"number",cuisineId:"number",authorId:"number",ownerId:"number",title:"string",description:"string",directions:"string",recipeImage:"string",equipmentImage:"string",ingredientsImage:"string",cookingImage:"string"},{recipeImage:"nobsc-recipe-default",equipmentImage:"nobsc-recipe-equipment-default",ingredientsImage:"nobsc-recipe-ingredients-default",cookingImage:"nobsc-recipe-cooking-default"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({recipeId:"number",methodId:"number"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({recipeId:"number",equipmentId:"number",amount:"number"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({recipeId:"number",ingredientId:"number",amount:"number",measurementId:"number"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({recipeId:"number",subrecipeId:"number",amount:"number",measurementId:"number"});e.exports=s},function(e,n,i){"use strict";const{Client:t,errors:s}=i(133),r=new t({node:process.env.ELASTICSEARCH_PROD});e.exports=r},function(e,n){e.exports=class{constructor(e){this.client=e,this.findRecipes=this.findRecipes.bind(this),this.autoRecipes=this.autoRecipes.bind(this),this.saveRecipe=this.saveRecipe.bind(this)}async findRecipes(e){const{body:n}=await this.client.search({index:"recipes",body:e});return n}async autoRecipes(e){const{body:n}=await this.client.search({index:"recipes",body:{highlight:{fragment_size:200,number_of_fragments:1,fields:{title:{}}},query:{bool:{must:[{match:{title:{query:e,operator:"and"}}}]}}},from:0,size:5});return n}async saveRecipe(e){const{recipeId:n,authorName:i,recipeTypeName:t,cuisineName:s,title:r,description:a,directions:c,recipeImage:o,methodNames:d,equipmentNames:p,ingredientNames:u,subrecipeNames:m}=e;await this.client.index({index:"recipes",id:n,body:{recipeId:n,authorName:i,recipeTypeName:t,cuisineName:s,title:r,description:a,directions:c,recipeImage:o,methodNames:d,equipmentNames:p,ingredientNames:u,subrecipeNames:m}}),await this.client.indices.refresh({index:"recipes"})}}},function(e,n,i){"use strict";i(31),i(5).config();const t=i(0),s=i(32),r=i(33),a=i(34),c=i(35),o=i(36),{equipmentRoutes:d,equipmentTypeRoutes:p,ingredientRoutes:u,ingredientTypeRoutes:m,recipeRoutes:l,recipeTypeRoutes:I,cuisineRoutes:_,methodRoutes:y,measurementRoutes:g,favoriteRecipeRoutes:h,staffRoutes:E,userRoutes:f,searchRoutes:w}=i(37),b=t(),R={origin:["http://localhost:8080"],credentials:!0};"production"===b.get("env")&&(b.set("trust proxy",1),R.origin=["https://nobullshitcooking.net"]),b.use(t.json()),b.use(s({windowMs:6e4,max:1e3})),b.use(a(R)),b.use(r()),b.use(c()),b.use(o());let N;b.get("/",(e,n)=>{try{console.log("No Bullshit Cooking Backend API 80-good-2."),n.send("No Bullshit Cooking Backend API.")}catch(e){console.log(e)}}),b.use("/equipment",d),b.use("/equipment-type",p),b.use("/ingredient",u),b.use("/ingredient-type",m),b.use("/recipe",l),b.use("/recipe-type",I),b.use("/cuisine",_),b.use("/method",y),b.use("/measurement",g),b.use("/favorite-recipe",h),b.use("/staff",E),b.use("/user",f),b.use("/search",w),process.on("unhandledRejection",(e,n)=>{console.log("Unhandled Rejection at:",e.stack||e)}),b.use((e,n,i,t)=>{i.json({error:{message:e.message,status:e.status||500}})}),"production"===b.get("env")?(N=process.env.PORT||8081,b.listen(N,"127.0.0.1",()=>console.log("Listening on port "+N))):(N=process.env.PORT||3003,server.listen(N,"0.0.0.0",()=>console.log("Listening on port "+N)))},function(e,n){e.exports=require("regenerator-runtime/runtime")},function(e,n){e.exports=require("express-rate-limit")},function(e,n){e.exports=require("express-sanitizer")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("helmet")},function(e,n){e.exports=require("compression")},function(e,n,i){const t=i(38),s=i(43),r=i(47),a=i(51),c=i(55),o=i(60),d=i(64),p=i(68),u=i(72),m=i(76),l=i(78),I=i(91),_=i(134);e.exports={equipmentRoutes:t,equipmentTypeRoutes:s,ingredientRoutes:r,ingredientTypeRoutes:a,recipeRoutes:c,recipeTypeRoutes:o,cuisineRoutes:d,methodRoutes:p,measurementRoutes:u,favoriteRecipeRoutes:m,staffRoutes:l,userRoutes:I,searchRoutes:_}},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(39),a=t();a.post("/",s(r.viewEquipment)),a.get("/official/all",s(r.viewAllOfficialEquipment)),a.get("/:equipmentId",s(r.viewEquipmentDetail)),e.exports=a},function(e,n,i){const t=i(3),s=i(11),r=i(41),a=i(42),c={viewEquipment:async function(e,n,i){try{const a=e.body.types?e.body.types:[],c=e.body.start?Number(e.sanitize(e.body.start)):0,o=25;r({types:a,starting:c,display:o});const d=new s(t);if(a.length>1){const e="?, ".repeat(a.length-1)+"?",i=await d.viewEquipmentOfTypes(c,o,e,a);let t=(await d.countEquipmentOfTypes(e,a))[0].total,s=t>o?Math.ceil(t/o):1;n.send({rows:i,pages:s,starting:c})}if(1==a.length){let e=`${a}`;const i=await d.viewEquipmentOfType(c,o,e);let t=(await d.countEquipmentOfType(e))[0].total,s=t>o?Math.ceil(t/o):1;n.send({rows:i,pages:s,starting:c})}if(0==a.length){const e=await d.viewAllEquipment(c,o);let i=(await d.countAllEquipment())[0].total,t=i>o?Math.ceil(i/o):1;n.send({rows:e,pages:t,starting:c})}i()}catch(e){i(e)}},viewAllOfficialEquipment:async function(e,n){const i=new s(t),r=await i.viewAllOfficialEquipment();n.send(r)},viewEquipmentDetail:async function(e,n){const i=Number(e.sanitize(e.params.equipmentId));a({equipmentId:i});const r=new s(t),[c]=await r.viewEquipmentById(i);n.send(c)}};e.exports=c},function(e,n){e.exports=require("mysql2/promise")},function(e,n,i){const{struct:t}=i(2),s=t({types:["string?|number?"],starting:"number",display:"number"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({equipmentId:"number",equipmentTypeId:"number?",equipmentName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(44),a=t();a.get("/",s(r.viewAllEquipmentTypes)),a.get("/:equipmentTypeId",s(r.viewEquipmentTypeById)),e.exports=a},function(e,n,i){const t=i(3),s=i(45),r=i(46),a={viewAllEquipmentTypes:async function(e,n){const i=new s(t),r=await i.viewAllEquipmentTypes();n.send(r)},viewEquipmentTypeById:async function(e,n){const i=Number(e.sanitize(e.params.equipmentTypeId));r({equipmentTypeId:i});const a=new s(t),[c]=await a.viewEquipmentTypeById(i);n.send(c)}};e.exports=a},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewAllEquipmentTypes=this.viewAllEquipmentTypes.bind(this),this.viewEquipmentTypeById=this.viewEquipmentTypeById.bind(this)}async viewAllEquipmentTypes(){const[e]=await this.pool.execute("\n      SELECT equipment_type_id, equipment_type_name\n      FROM nobsc_equipment_types\n    ");return e}async viewEquipmentTypeById(e){const[n]=await this.pool.execute("\n      SELECT equipment_type_id, equipment_type_name\n      FROM nobsc_equipment_types\n      WHERE equipment_type_id = ?\n    ",[e]);return n}}},function(e,n,i){const{struct:t}=i(2),s=t({equipmentTypeId:"number",equipmentTypeName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(48),a=t();a.post("/",s(r.viewIngredient)),a.get("/official/all",s(r.viewAllOfficialIngredients)),a.get("/:ingredientId",s(r.viewIngredientDetail)),e.exports=a},function(e,n,i){const t=i(3),s=i(12),r=i(49),a=i(50),c={viewIngredient:async function(e,n,i){try{const a=e.body.types?e.body.types:[],c=e.body.start?Number(e.sanitize(e.body.start)):0,o=25;r({types:a,starting:c,display:o});const d=new s(t);if(a.length>1){const e="?, ".repeat(a.length-1)+"?",i=await d.viewIngredientsOfTypes(c,o,e,a);let t=(await d.countIngredientsOfTypes(e,a))[0].total,s=t>o?Math.ceil(t/o):1;n.send({rows:i,pages:s,starting:c})}if(1==a.length){let e=`${a}`;const i=await d.viewIngredientsOfType(c,o,e);let t=(await d.countIngredientsOfType(e))[0].total,s=t>o?Math.ceil(t/o):1;n.send({rows:i,pages:s,starting:c})}if(0==a.length){const e=await d.viewAllIngredients(c,o);let i=(await d.countAllIngredients())[0].total,t=i>o?Math.ceil(i/o):1;n.send({rows:e,pages:t,starting:c})}i()}catch(e){i(e)}},viewAllOfficialIngredients:async function(e,n){const i=new s(t),r=await i.viewAllOfficialIngredients();n.send(r)},viewIngredientDetail:async function(e,n){const i=Number(e.sanitize(e.params.ingredientId));a({ingredientId:i});const r=new s(t),[c]=await r.viewIngredientById(i);n.send(c)}};e.exports=c},function(e,n,i){const{struct:t}=i(2),s=t({types:["string?|number?"],starting:"number",display:"number"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({ingredientId:"number",ingredientTypeId:"number?",ingredientName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(52),a=t();a.get("/",s(r.viewAllIngredientTypes)),a.get("/:ingredientTypeId",s(r.viewIngredientTypeById)),e.exports=a},function(e,n,i){const t=i(3),s=i(53),r=i(54),a={viewAllIngredientTypes:async function(e,n){const i=new s(t),r=await i.viewAllIngredientTypes();n.send(r)},viewIngredientTypeById:async function(e,n){const i=Number(e.sanitize(e.params.ingredientTypeId));r({ingredientTypeId:i});const a=new s(t),[c]=await a.viewIngredientTypeById(i);n.send(c)}};e.exports=a},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewAllIngredientTypes=this.viewAllIngredientTypes.bind(this),this.viewIngredientTypeById=this.viewIngredientTypeById.bind(this)}async viewAllIngredientTypes(){const[e]=await this.pool.execute("\n      SELECT ingredient_type_id, ingredient_type_name\n      FROM nobsc_ingredient_types\n    ");return e}async viewIngredientTypeById(e){const[n]=await this.pool.execute("\n      SELECT ingredient_type_id, ingredient_type_name\n      FROM nobsc_ingredient_types\n      WHERE ingredient_type_id = ?\n    ",[e]);return console.log(n),n}}},function(e,n,i){const{struct:t}=i(2),s=t({ingredientTypeId:"number",ingredientTypeName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(56),a=t();a.post("/",s(r.viewRecipe)),a.get("/official/all",s(r.viewAllOfficialRecipes)),a.get("/public/all",s(r.viewAllPublicRecipes)),a.get("/:recipeId",s(r.viewRecipeDetail)),e.exports=a},function(e,n,i){const t=i(3),s=i(8),r=i(58),a=i(59),c={viewRecipe:async function(e,n,i){try{const a=e.body.types?e.body.types:[],c=e.body.cuisines?e.body.cuisines:[],o=e.body.start?e.sanitize(e.body.start):0,d=25;r({types:a,cuisines:c,starting:o,display:d});const p=new s(t);if(c.length>1){const e="?, ".repeat(c.length-1)+"?";if(a.length>1){let i=c.concat(a);const t="?, ".repeat(a.length-1)+"?",s=await p.viewRecipesOfCuisinesAndTypes(o,d,e,t,i);let r=(await p.countRecipesOfCuisinesAndTypes(e,t,i))[0].total,u=r>d?Math.ceil(r/d):1;n.send({rows:s,pages:u,starting:o})}if(1==a.length){let i=c.concat(a);const t=await p.viewRecipesOfCuisinesAndType(o,d,e,i);let s=(await p.countRecipesOfCuisinesAndType(e,i))[0].total,r=s>d?Math.ceil(s/d):1;n.send({rows:t,pages:r,starting:o})}if(0==a.length){const i=await p.viewRecipesOfCuisines(o,d,e,c);let t=(await p.countRecipesOfCuisines(e,c))[0].total,s=t>d?Math.ceil(t/d):1;n.send({rows:i,pages:s,starting:o})}}if(1==c.length){if(a.length>1){let e=c.concat(a);const i="?, ".repeat(a.length-1)+"?",t=await p.viewRecipesOfCuisineAndTypes(o,d,i,e);let s=(await p.countRecipesOfCuisineAndTypes(i,e))[0].total,r=s>d?Math.ceil(s/d):1;n.send({rows:t,pages:r,starting:o})}if(1==a.length){let e=c.concat(a);const i=await p.viewRecipesOfCuisineAndType(o,d,e);let t=(await p.countRecipesOfCuisineAndType(e))[0].total,s=t>d?Math.ceil(t/d):1;n.send({rows:i,pages:s,starting:o})}if(0==a.length){let e=`${c}`;const i=await p.viewRecipesOfCuisine(o,d,e);let t=(await p.countRecipesOfCuisine(e))[0].total,s=t>d?Math.ceil(t/d):1;n.send({rows:i,pages:s,starting:o})}}if(0==c.length){if(a.length>1){const e="?, ".repeat(a.length-1)+"?",i=await p.viewRecipesOfTypes(o,d,e,a);let t=(await p.countRecipesOfTypes(e,a))[0].total,s=t>d?Math.ceil(t/d):1;n.send({rows:i,pages:s,starting:o})}if(1==a.length){let e=`${a}`;const i=await p.viewRecipesOfType(o,d,e);let t=(await p.countRecipesOfType(e))[0].total,s=t>d?Math.ceil(t/d):1;n.send({rows:i,pages:s,starting:o})}if(0==a.length){const e=await p.viewAllRecipes(o,d);let i=(await p.countAllRecipes())[0].total,t=i>d?Math.ceil(i/d):1;n.send({rows:e,pages:t,starting:o})}}i()}catch(e){i(e)}},viewAllOfficialRecipes:async function(e,n){const i=new s(t),r=await i.viewAllOfficialRecipes();n.send(r)},viewAllPublicRecipes:async function(e,n){const i=new s(t),r=await i.viewAllPublicRecipes();n.send(r)},viewRecipeDetail:async function(e,n,i){try{const r=Number(e.sanitize(e.params.recipeId));a({recipeId:r});const c=new s(t),o=await c.viewRecipeById(r);n.send(o),i()}catch(e){i(e)}}};e.exports=c},function(e,n){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,n,i){const{struct:t}=i(2),s=t({types:["string?|number?"],cuisines:["string?|number?"],starting:"number",display:"number"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({recipeId:"number",recipeTypeId:"number?",cuisineId:"number?",title:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(61),a=t();a.get("/",s(r.viewAllRecipeTypes)),a.get("/:recipeTypeId",s(r.viewRecipeTypeById)),e.exports=a},function(e,n,i){const t=i(3),s=i(62),r=i(63),a={viewAllRecipeTypes:async function(e,n){const i=new s(t),r=await i.viewAllRecipeTypes();n.send(r)},viewRecipeTypeById:async function(e,n){const i=Number(e.sanitize(e.params.recipeTypeId));r({recipeTypeId:i});const a=new s(t),[c]=await a.viewRecipeTypeById(i);n.send(c)}};e.exports=a},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewAllRecipeTypes=this.viewAllRecipeTypes.bind(this),this.viewRecipeTypeById=this.viewRecipeTypeById.bind(this)}async viewAllRecipeTypes(){const[e]=await this.pool.execute("\n      SELECT recipe_type_id, recipe_type_name\n      FROM nobsc_recipe_types\n    ");return e}async viewRecipeTypeById(e){const[n]=await this.pool.execute("\n      SELECT recipe_type_id, recipe_type_name\n      FROM nobsc_recipe_types\n      WHERE recipe_type_id = ?\n    ",[e]);return n}}},function(e,n,i){const{struct:t}=i(2),s=t({recipeTypeId:"number",recipeTypeName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(65),a=t();a.get("/",s(r.viewAllCuisines)),a.get("/:cuisineId",s(r.viewCuisineById)),e.exports=a},function(e,n,i){const t=i(3),s=i(66),r=i(67),a={viewAllCuisines:async function(e,n){const i=new s(t),r=await i.viewAllCuisines();n.send(r)},viewCuisineById:async function(e,n){const i=Number(e.sanitize(e.params.cuisineId));r({cuisineId:i});const a=new s(t),[c]=await a.viewCuisineById(i);n.send(c)}};e.exports=a},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewAllCuisines=this.viewAllCuisines.bind(this),this.viewCuisineById=this.viewCuisineById.bind(this)}async viewAllCuisines(){const[e]=await this.pool.execute("\n      SELECT cuisine_id, cuisine_name\n      FROM nobsc_cuisines\n    ");return e}async viewCuisineById(e){const[n]=await this.pool.execute("\n      SELECT cuisine_id, cuisine_name\n      FROM nobsc_cuisines\n      WHERE cuisine_id = ?\n    ",[e]);return n}}},function(e,n,i){const{struct:t}=i(2),s=t({cuisineId:"number",cuisineName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(69),a=t();a.get("/",s(r.viewAllMethods)),a.get("/:methodId",s(r.viewMethodById)),e.exports=a},function(e,n,i){const t=i(3),s=i(70),r=i(71),a={viewAllMethods:async function(e,n){const i=new s(t),r=await i.viewAllMethods();n.send(r)},viewMethodById:async function(e,n){const i=Number(e.sanitize(e.params.methodId));r({methodId:i});const a=new s(t),[c]=await a.viewMethodById(i);n.send(c)}};e.exports=a},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewAllMethods=this.viewAllMethods.bind(this),this.viewMethodById=this.viewMethodById.bind(this)}async viewAllMethods(){const[e]=await this.pool.execute("\n      SELECT method_id, method_name\n      FROM nobsc_methods\n    ");return e}async viewMethodById(e){const[n]=await this.pool.execute("\n      SELECT method_id, method_name\n      FROM nobsc_methods\n      WHERE method_id = ?\n    ",[e]);return n}}},function(e,n,i){const{struct:t}=i(2),s=t({methodId:"number",methodName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(73),a=t();a.get("/",s(r.viewAllMeasurements)),a.get("/:measurementId",s(r.viewMeasurementById)),e.exports=a},function(e,n,i){const t=i(3),s=i(74),r=i(75),a={viewAllMeasurements:async function(e,n){const i=new s(t),r=await i.viewAllMeasurements();n.send(r)},viewMeasurementById:async function(e,n){const i=Number(e.sanitize(e.params.measurementId));r({measurementId:i});const a=new s(t),[c]=await a.viewMeasurementById(i);n.send(c)}};e.exports=a},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewAllMeasurements=this.viewAllMeasurements.bind(this),this.viewMeasurementById=this.viewMeasurementById.bind(this)}async viewAllMeasurements(){const[e]=await this.pool.execute("\n      SELECT measurement_id, measurement_name\n      FROM nobsc_measurements\n    ");return e}async viewMeasurementById(e){const[n]=await this.pool.execute("\n      SELECT measurement_id, measurement_name\n      FROM nobsc_measurements\n      WHERE measurement_id = ?\n    ",[e]);return n}}},function(e,n,i){const{struct:t}=i(2),s=t({measurementId:"number",measurementName:"string?"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(77),a=t();a.get("/",s(r.viewMostFavorited)),e.exports=a},function(e,n,i){const t=i(3),s=i(9),r={viewMostFavorited:async function(e,n){const i=e.body.limit,r=new s(t),a=await r.viewMostFavorited(i);n.send(a)}};e.exports=r},function(e,n,i){const{Router:t}=i(0),s=i(79),r=i(85),a=i(87),c=i(89),o=t();o.use("/auth",s),o.use("/equipment",r),o.use("/ingredient",a),o.use("/recipe",c),e.exports=o},function(e,n,i){const{Router:t}=i(0),s=i(10),r=i(1),a=i(80),c=t();c.post("/logout",s,r(a.logout)),c.post("/login",r(a.login)),c.post("/register",r(a.register)),e.exports=c},function(e,n,i){const t=i(17),s=i(3),r=i(81),a=i(82),c=i(83),o=i(84),d={register:async function(e,n){const i=e.sanitize(e.body.staffInfo.email),a=e.sanitize(e.body.staffInfo.password),d=e.sanitize(e.body.staffInfo.staffname);if(c({email:i,pass:a,staffname:d}),d.length<6)return n.send({message:"Staffname must be at least 6 characters."});if(d.length>20)return n.send({message:"Staffname must be no more than 20 characters."});if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(i))return n.send({message:"Invalid email."});if(a.length<6)return n.send({message:"Password must be at least 6 characters."});if(a.length>54)return n.send({message:"Password must be no more than 54 characters."});const p=new r(s);if((await p.getStaffByName(d)).length)return n.send({message:"Staffname already taken."});if((await p.getStaffByEmail(i)).length)return n.send({message:"Email already in use."});const u=await t.hash(a,10),m=o({email:i,pass:u,staffname:d});await p.createStaff(m),n.send({message:"Staff account created."})},login:async function(e,n){const i=e.sanitize(e.body.staffInfo.email),c=e.sanitize(e.body.staffInfo.password);if(a({email:i,pass:c}),!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(i))return n.send({message:"Invalid email."});if(c.length<6)return n.send({message:"Invalid password."});if(c.length>54)return n.send({message:"Invalid password."});const o=new r(s),d=await o.getStaffByEmail(i);if(d&&d[0].email==i){if(await t.compare(c,d[0].pass)){const i=d[0].staff_id,t=d[0].staffname,s=d[0].avatar;return e.session.staffInfo={},e.session.staffInfo.staffId=i,e.session.staffInfo.staffname=t,n.json({message:"Signed in.",staffname:t,avatar:s})}}n.send({message:"Incorrect email or password."})},logout:async function(e,n){await e.session.destroy(),n.end()}};e.exports=d},function(e,n){e.exports=class{constructor(e){this.pool=e,this.getStaffByEmail=this.getStaffByEmail.bind(this),this.getStaffByName=this.getStaffByName.bind(this),this.viewAllStaff=this.viewAllStaff.bind(this),this.viewStaffById=this.viewStaffById.bind(this),this.createStaff=this.createStaff.bind(this)}async getStaffByEmail(e){const[n]=await this.pool.execute("\n      SELECT staff_id, email, pass, staffname\n      FROM nobsc_staff\n      WHERE email = ?\n    ",[e]);return n}async getStaffByName(e){const[n]=await this.pool.execute("\n      SELECT staff_id, email, pass, staffname\n      FROM nobsc_staff\n      WHERE staffname = ?\n    ",[e]);return n}async viewAllStaff(e,n){const[i]=await this.pool.execute("\n      SELECT staffname, avatar\n      FROM nobsc_staff\n      ORDER BY staffname ASC\n      LIMIT ?, ?\n    ",[e,n]);if(!i)throw new Error("viewAllStaff failed");return i}async viewStaffById(e){const[n]=await this.pool.execute("\n      SELECT staffname, avatar\n      FROM nobsc_staff\n      WHERE staff_id = ?\n    ",[e]);if(!n)throw new Error("viewStaffById failed");return n}async createStaff(e){const{email:n,pass:i,staffname:t}=e,[s]=await this.pool.execute("\n      INSERT INTO nobsc_staff (email, pass, staffname)\n      VALUES (?, ?, ?)\n    ",[n,i,t]);if(!s)throw new Error("createdStaff failed");return s}}},function(e,n,i){const{struct:t}=i(2),s=t({email:"string",pass:"string"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({email:"string",pass:"string",staffname:"string"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({email:"string",pass:"string",staffname:"string",avatar:"string?",role:"string?"},{avatar:"nobsc-staff-default",role:"staff"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(10),r=i(1),a=i(86),c=t();c.post("/create",s,r(a.createEquipment)),c.put("/update",s,r(a.updateEquipment)),c.delete("/delete",s,r(a.deleteEquipment)),e.exports=c},function(e,n,i){const t=i(3),s=i(11),r=i(18),a={createEquipment:async function(e,n,i){try{const a=Number(e.sanitize(e.body.equipmentInfo.equipmentTypeId)),c=e.sanitize(e.body.equipmentInfo.equipmentName),o=e.sanitize(e.body.equipmentInfo.equipmentDescription),d=e.sanitize(e.body.equipmentInfo.equipmentImage),p=r({equipmentTypeId:a,authorId:1,ownerId:1,equipmentName:c,equipmentDescription:o,equipmentImage:d}),u=new s(t),[m]=await u.createEquipment(p);n.send(m),i()}catch(e){i(e)}},updateEquipment:async function(e,n,i){try{const a=e.sanitize(e.body.equipmentInfo.equipmentId),c=Number(e.sanitize(e.body.equipmentInfo.equipmentTypeId)),o=e.sanitize(e.body.equipmentInfo.equipmentName),d=e.sanitize(e.body.equipmentInfo.equipmentDescription),p=e.sanitize(e.body.equipmentInfo.equipmentImage),u=r({equipmentTypeId:c,authorId:1,ownerId:1,equipmentName:o,equipmentDescription:d,equipmentImage:p}),m=new s(t),[l]=await m.updateEquipment(u,a);n.send(l),i()}catch(e){i(e)}},deleteEquipment:async function(e,n,i){try{const r=e.sanitize(e.body.equipmentId),a=new s(t),[c]=await a.deleteEquipment(r);n.send(c),i()}catch(e){i(e)}}};e.exports=a},function(e,n,i){const{Router:t}=i(0),s=i(10),r=i(1),a=i(88),c=t();c.post("/create",s,r(a.createIngredient)),c.put("/update",s,r(a.updateIngredient)),c.delete("/delete",s,r(a.deleteIngredient)),e.exports=c},function(e,n,i){const t=i(3),s=i(12),r=i(19),a={createIngredient:async function(e,n,i){try{const a=Number(e.sanitize(e.body.ingredientInfo.ingredientTypeId)),c=e.sanitize(e.body.ingredientInfo.ingredientName),o=e.sanitize(e.body.ingredientInfo.ingredientDescription),d=e.sanitize(e.body.ingredientInfo.ingredientImage),p=r({ingredientTypeId:a,authorId:1,ownerId:1,ingredientName:c,ingredientDescription:o,ingredientImage:d}),u=new s(t),[m]=await u.createIngredient(p);n.send(m),i()}catch(e){i(e)}},updateIngredient:async function(e,n,i){try{const a=e.sanitize(e.body.ingredientInfo.ingredientId),c=Number(e.sanitize(e.body.ingredientInfo.ingredientTypeId)),o=e.sanitize(e.body.ingredientInfo.ingredientName),d=e.sanitize(e.body.ingredientInfo.ingredientDescription),p=e.sanitize(e.body.ingredientInfo.ingredientImage),u=r({ingredientTypeId:c,authorId:1,ownerId:1,ingredientName:o,ingredientDescription:d,ingredientImage:p}),m=new s(t),[l]=await m.updateIngredient(u,a);n.send(l),i()}catch(e){i(e)}},deleteIngredient:async function(e,n,i){try{const r=e.sanitize(e.body.ingredientId),a=new s(t),[c]=await a.deleteIngredient(r);n.send(c),i()}catch(e){i(e)}}};e.exports=a},function(e,n,i){const{Router:t}=i(0),s=i(10),r=i(1),a=i(90),c=t();c.post("/create",s,r(a.createRecipe)),c.put("/update",s,r(a.updateRecipe)),c.delete("/delete",s,r(a.deleteRecipe)),e.exports=c},function(e,n,i){const t=i(3),s=i(8),r=i(20),a=i(13),c=i(14),o=i(21),d=i(9),p=i(22),u=i(23),m=i(24),l=i(25),I=i(26),_=i(27),y={createRecipe:async function(e,n,i){try{const d=Number(e.sanitize(e.body.recipeInfo.recipeTypeId)),p=Number(e.sanitize(e.body.recipeInfo.cuisineId)),y=e.sanitize(e.body.recipeInfo.title),g=e.sanitize(e.body.recipeInfo.description),h=e.sanitize(e.body.recipeInfo.directions),E=e.body.recipeInfo.requiredMethods,f=e.body.recipeInfo.requiredEquipment,w=e.body.recipeInfo.requiredIngredients,b=e.body.recipeInfo.requiredSubrecipes,R=e.sanitize(e.body.recipeInfo.recipeImage),N=e.sanitize(e.body.recipeInfo.recipeEquipmentImage),v=e.sanitize(e.body.recipeInfo.recipeIngredientsImage),S=e.sanitize(e.body.recipeInfo.recipeCookingImage),q=u({recipeTypeId:d,cuisineId:p,authorId:1,ownerId:1,title:y,description:g,directions:h,recipeImage:R,equipmentImage:N,ingredientsImage:v,cookingImage:S}),A=new s(t),[T]=await A.createRecipe(q),O=T.insertId;if("none"!==E&&E.length>0&&E.map(e=>m({recipeId:O,methodId:e.methodId}))){let e=[];E.map(n=>{e.push(O,n.methodId)});const n="(?, ?),".repeat(E.length).slice(0,-1),i=new r(t);await i.createRecipeMethods(e,n)}if("none"!==f&&f.length>0&&f.map(e=>l({recipeId:O,equipmentId:e.equipment,amount:e.amount}))){let e=[];f.map(n=>{e.push(O,n.equipment,n.amount)});const n="(?, ?, ?),".repeat(f.length).slice(0,-1);console.log(e),console.log(n);const i=new a(t);await i.createRecipeEquipment(e,n)}if("none"!==w&&w.length>0&&w.map(e=>I({recipeId:O,ingredientId:e.ingredient,amount:e.amount,measurementId:e.unit}))){let e=[];w.map(n=>{e.push(O,n.ingredient,n.amount,n.unit)});const n="(?, ?, ?, ?),".repeat(w.length).slice(0,-1),i=new c(t);await i.createRecipeIngredients(e,n)}if("none"!==b&&b.length>0&&b.map(e=>_({recipeId:O,subrecipeId:e.subrecipe,amount:e.amount,measurementId:e.unit}))){let e=[];b.map(n=>{e.push(O,n.subrecipe,n.amount,n.unit)});const n="(?, ?, ?, ?),".repeat(b.length).slice(0,-1),i=new o(t);await i.createRecipeSubrecipes(e,n)}n.send({message:"Recipe created."}),i()}catch(e){i(e)}},updateRecipe:async function(e,n,i){try{const d=e.sanitize(e.body.recipeInfo.recipeId),p=Number(e.sanitize(e.body.recipeInfo.recipeTypeId)),y=Number(e.sanitize(e.body.recipeInfo.cuisineId)),g=e.sanitize(e.body.recipeInfo.title),h=e.sanitize(e.body.recipeInfo.description),E=e.sanitize(e.body.recipeInfo.directions),f=e.body.recipeInfo.requiredMethods,w=e.body.recipeInfo.requiredEquipment,b=e.body.recipeInfo.requiredIngredients,R=e.body.recipeInfo.requiredSubrecipes,N=e.sanitize(e.body.recipeInfo.recipeImage),v=e.sanitize(e.body.recipeInfo.recipeEquipmentImage),S=e.sanitize(e.body.recipeInfo.recipeIngredientsImage),q=e.sanitize(e.body.recipeInfo.recipeCookingImage),A=u({recipeTypeId:p,cuisineId:y,authorId:1,ownerId:1,title:g,description:h,directions:E,recipeImage:N,equipmentImage:v,ingredientsImage:S,cookingImage:q}),T=new s(t);await T.updateRecipe(A,d);let O="none";"none"!==f&&f.map(e=>m({recipeId:generatedId,methodId:e.methodId}))&&(O=[],f.map(e=>{O.push(generatedId,e.methodId)}));const M="none"!==f?"(?, ?),".repeat(f.length).slice(0,-1):"none",x=new r(t);await x.updateRecipeMethods(O,M,d);let U="none";"none"!==w&&w.map(e=>l({recipeId:generatedId,equipmentId:e.equipment,amount:e.amount}))&&(U=[],w.map(e=>{U.push(generatedId,e.equipment,e.amount)}));const P="none"!==w?"(?, ?, ?),".repeat(w.length).slice(0,-1):"none",C=new a(t);await C.updateRecipeEquipment(U,P,d);let F="none";"none"!==b&&b.map(e=>I({recipeId:generatedId,ingredientId:e.ingredient,amount:e.amount,measurementId:e.unit}))&&(F=[],b.map(e=>{F.push(generatedId,e.ingredient,e.amount,e.unit)}));const B="none"!==b?"(?, ?, ?, ?),".repeat(b.length).slice(0,-1):"none",D=new c(t);await D.updateRecipeIngredients(F,B,d);let L="none";"none"!==R&&R.map(e=>_({recipeId:generatedId,subrecipeId:e.subrecipe,amount:e.amount,measurementId:e.unit}))&&(L=[],R.map(e=>{L.push(generatedId,e.subrecipe,e.amount,e.unit)}));const z="none"!==R?"(?, ?, ?, ?),".repeat(R.length).slice(0,-1):"none",W=new o(t);await W.updateRecipeSubrecipes(L,z,d),n.send("Recipe updated."),i()}catch(e){i(e)}},deleteRecipe:async function(e,n,i){try{const u=e.sanitize(e.body.recipeId),m=new d(t),l=new p(t),I=new r(t),_=new a(t),y=new c(t),g=new o(t),h=new s(t);await m.deleteAllFavoritesOfRecipe(u),await l.deleteAllSavesOfRecipe(u),await I.deleteRecipeMethods(u),await _.deleteRecipeEquipment(u),await y.deleteRecipeIngredients(u),await g.deleteRecipeSubrecipes(u),await g.deleteRecipeSubrecipesBySubrecipeId(u),await h.deleteRecipe(u),n.send("Recipe deleted."),i()}catch(e){i(e)}}};e.exports=y},function(e,n,i){const{Router:t}=i(0),s=i(92),r=i(97),a=i(99),c=i(101),o=i(103),d=i(105),p=i(107),u=i(109),m=i(111),l=i(113),I=i(117),_=i(120),y=i(123),g=i(127),h=i(129),E=i(131),f=t();f.use("/auth",s),f.use("/profile",r),f.use("/get-signed-url/avatar",a),f.use("/get-signed-url/equipment",c),f.use("/get-signed-url/ingredient",o),f.use("/get-signed-url/recipe",d),f.use("/get-signed-url/recipe-equipment",p),f.use("/get-signed-url/recipe-ingredients",u),f.use("/get-signed-url/recipe-cooking",m),f.use("/friendship",l),f.use("/favorite-recipe",I),f.use("/saved-recipe",_),f.use("/plan",y),f.use("/equipment",g),f.use("/ingredient",h),f.use("/recipe",E),e.exports=f},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(93),c=t();c.post("/logout",r(a.logout)),c.post("/login",r(a.login)),c.post("/register",r(a.register)),c.post("/set-avatar",s,r(a.setAvatar)),e.exports=c},function(e,n,i){const t=i(17),s=i(3),r=i(15),a=i(94),c=i(95),o=i(96),d={register:async function(e,n){const i=e.sanitize(e.body.userInfo.email),a=e.sanitize(e.body.userInfo.password),d=e.sanitize(e.body.userInfo.username);if(c({email:i,pass:a,username:d}),d.length<6)return n.send({message:"Username must be at least 6 characters."});if(d.length>20)return n.send({message:"Username must be no more than 20 characters."});if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(i))return n.send({message:"Invalid email."});if(a.length<6)return n.send({message:"Password must be at least 6 characters."});if(a.length>54)return n.send({message:"Password must be no more than 54 characters."});const p=new r(s);if((await p.getUserByName(d)).length)return n.send({message:"Username already taken."});if((await p.getUserByEmail(i)).length)return n.send({message:"Email already in use."});const u=await t.hash(a,10),m=o({email:i,pass:u,username:d});await p.createUser(m),n.send({message:"User account created."})},login:async function(e,n){const i=e.sanitize(e.body.userInfo.email),c=e.sanitize(e.body.userInfo.password);if(a({email:i,pass:c}),!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(i))return n.send({message:"Invalid email."});if(c.length<6)return n.send({message:"Invalid password."});if(c.length>54)return n.send({message:"Invalid password."});const o=new r(s),d=await o.getUserByEmail(i);if(d.length&&d[0].email==i){if(await t.compare(c,d[0].pass)){const i=d[0].user_id,t=d[0].username,s=d[0].avatar;return e.session.userInfo={},e.session.userInfo.userId=i,e.session.userInfo.username=t,e.session.userInfo.avatar=s,n.json({message:"Signed in.",username:t,avatar:s})}}n.send({message:"Incorrect email or password."})},logout:async function(e,n){await e.session.destroy(),n.end()},setAvatar:async function(e,n){const i=e.sanitize(e.body.avatar),t=e.session.userInfo.userId,a=new r(s);await a.setAvatar(i,t),n.send({message:"Avatar set."})}};e.exports=d},function(e,n,i){const{struct:t}=i(2),s=t({email:"string",pass:"string"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({email:"string",pass:"string",username:"string"});e.exports=s},function(e,n,i){const{struct:t}=i(2),s=t({email:"string",pass:"string",username:"string",avatar:"string?"},{avatar:"nobsc-user-default"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(98),a=t();a.get("/:username",s(r.viewProfile)),e.exports=a},function(e,n,i){const t=i(3),s=i(15),r=i(8),a=i(9),c={viewProfile:async function(e,n){const i=e.sanitize(e.params.username),c=new s(t),o=await c.getUserIdByUsername(i),d=o[0].user_id,p=o[0].avatar,u=new r(t),m=await u.viewAllMyPublicUserRecipes(d,1),l=new a(t),I=await l.viewMyFavoriteRecipes(d);n.send({message:"Success.",avatar:p,publicRecipes:m,favoriteRecipes:I})}};e.exports=c},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(100),c=t();c.post("/",s,r(a)),e.exports=c},function(e,n,i){i(5).config();const t=i(6),s=process.env.AWS_NOBSC_USER_AVATARS_S3_BUCKET;e.exports=async function(e,n){const i=`${e.session.userInfo.username}`,r=`${i}-tiny`,a=e.sanitize(e.body.fileType),c=new t.S3({accessKeyId:process.env.AWS_NOBSC_USER_AVATARS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_NOBSC_USER_AVATARS_SECRET_ACCESS_KEY}),o=(e,n)=>new Promise((i,t)=>{c.getSignedUrl(e,n,(e,n)=>{e?t(e):i(n)})}),d=await o("putObject",{Bucket:s,Key:i,ContentType:a,Expires:50}),p=await o("putObject",{Bucket:s,Key:r,ContentType:a,Expires:50});n.json({success:!0,signedRequestFullSize:d,signedRequestTinySize:p,urlFullSize:i})}},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(102),c=t();c.post("/",s,r(a)),e.exports=c},function(e,n,i){i(5).config();const t=i(7),s=i(6),r=process.env.AWS_NOBSC_USER_EQUIPMENT_S3_BUCKET;e.exports=async function(e,n){const i=`${e.session.userInfo.username}-${t()}`,a=`${i}-tiny`,c=e.sanitize(e.body.fileType),o=new s.S3({accessKeyId:process.env.AWS_NOBSC_USER_EQUIPMENT_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_NOBSC_USER_EQUIPMENT_SECRET_ACCESS_KEY}),d=(e,n)=>new Promise((i,t)=>{o.getSignedUrl(e,n,(e,n)=>{e?t(e):i(n)})}),p=await d("putObject",{Bucket:r,Key:i,ContentType:c,Expires:50}),u=await d("putObject",{Bucket:r,Key:a,ContentType:c,Expires:50});n.json({success:!0,signedRequestFullSize:p,signedRequestTinySize:u,urlFullSize:i})}},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(104),c=t();c.post("/",s,r(a)),e.exports=c},function(e,n,i){i(5).config();const t=i(7),s=i(6),r=process.env.AWS_NOBSC_USER_INGREDIENTS_S3_BUCKET;e.exports=async function(e,n){const i=`${e.session.userInfo.username}-${t()}`,a=`${i}-tiny`,c=e.sanitize(e.body.fileType),o=new s.S3({accessKeyId:process.env.AWS_NOBSC_USER_INGREDIENTS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_NOBSC_USER_INGREDIENTS_SECRET_ACCESS_KEY}),d=(e,n)=>new Promise((i,t)=>{o.getSignedUrl(e,n,(e,n)=>{e?t(e):i(n)})}),p=await d("putObject",{Bucket:r,Key:i,ContentType:c,Expires:50}),u=await d("putObject",{Bucket:r,Key:a,ContentType:c,Expires:50});n.json({success:!0,signedRequestFullSize:p,signedRequestTinySize:u,urlFullSize:i})}},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(106),c=t();c.post("/",s,r(a)),e.exports=c},function(e,n,i){i(5).config();const t=i(7),s=i(6),r=process.env.AWS_NOBSC_USER_RECIPE_S3_BUCKET;e.exports=async function(e,n){const i=`${e.session.userInfo.username}-${t()}`,a=`${i}-thumb`,c=`${i}-tiny`,o=e.sanitize(e.body.fileType),d=new s.S3({accessKeyId:process.env.AWS_NOBSC_USER_RECIPE_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_NOBSC_USER_RECIPE_SECRET_ACCESS_KEY}),p=(e,n)=>new Promise((i,t)=>{d.getSignedUrl(e,n,(e,n)=>{e?t(e):i(n)})}),u=await p("putObject",{Bucket:r,Key:i,ContentType:o,Expires:50}),m=await p("putObject",{Bucket:r,Key:a,ContentType:o,Expires:50}),l=await p("putObject",{Bucket:r,Key:c,ContentType:o,Expires:50});n.json({success:!0,signedRequestFullSize:u,signedRequestThumbSize:m,signedRequestTinySize:l,urlFullSize:i})}},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(108),c=t();c.post("/",s,r(a)),e.exports=c},function(e,n,i){i(5).config();const t=i(7),s=i(6),r=process.env.AWS_NOBSC_USER_RECIPE_EQUIPMENT_S3_BUCKET;e.exports=async function(e,n){const i=`${e.session.userInfo.username}-${t()}`,a=e.sanitize(e.body.fileType),c=new s.S3({accessKeyId:process.env.AWS_NOBSC_USER_RECIPE_EQUIPMENT_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_NOBSC_USER_RECIPE_EQUIPMENT_SECRET_ACCESS_KEY}),o=await((e,n)=>new Promise((i,t)=>{c.getSignedUrl(e,n,(e,n)=>{e?t(e):i(n)})}))("putObject",{Bucket:r,Key:i,ContentType:a,Expires:50});n.json({success:!0,signedRequestFullSize:o,urlFullSize:i})}},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(110),c=t();c.post("/",s,r(a)),e.exports=c},function(e,n,i){i(5).config();const t=i(7),s=i(6),r=process.env.AWS_NOBSC_USER_RECIPE_INGREDIENTS_S3_BUCKET;e.exports=async function(e,n){const i=`${e.session.userInfo.username}-${t()}`,a=e.sanitize(e.body.fileType),c=new s.S3({accessKeyId:process.env.AWS_NOBSC_USER_RECIPE_INGREDIENTS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_NOBSC_USER_RECIPE_INGREDIENTS_SECRET_ACCESS_KEY}),o=await((e,n)=>new Promise((i,t)=>{c.getSignedUrl(e,n,(e,n)=>{e?t(e):i(n)})}))("putObject",{Bucket:r,Key:i,ContentType:a,Expires:50});n.json({success:!0,signedRequestFullSize:o,urlFullSize:i})}},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(112),c=t();c.post("/",s,r(a)),e.exports=c},function(e,n,i){i(5).config();const t=i(7),s=i(6),r=process.env.AWS_NOBSC_USER_RECIPE_COOKING_S3_BUCKET;e.exports=async function(e,n){const i=`${e.session.userInfo.username}-${t()}`,a=e.sanitize(e.body.fileType),c=new s.S3({accessKeyId:process.env.AWS_NOBSC_USER_RECIPE_COOKING_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_NOBSC_USER_RECIPE_COOKING_SECRET_ACCESS_KEY}),o=await((e,n)=>new Promise((i,t)=>{c.getSignedUrl(e,n,(e,n)=>{e?t(e):i(n)})}))("putObject",{Bucket:r,Key:i,ContentType:a,Expires:50});n.json({success:!0,signedRequestFullSize:o,urlFullSize:i})}},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(114),c=t();c.post("/",s,r(a.viewAllMyFriendships)),c.post("/create",s,r(a.createFriendship)),c.put("/accept",s,r(a.acceptFriendship)),c.put("/reject",s,r(a.rejectFriendship)),c.delete("/delete",s,r(a.deleteFriendship)),c.post("/block",s,r(a.blockUser)),c.delete("/unblock",s,r(a.unblockUser)),e.exports=c},function(e,n,i){const t=i(3),s=i(15),r=i(115),a=i(116),c={viewAllMyFriendships:async function(e,n){const i=e.session.userInfo.userId,s=new r(t),a=await s.viewAllMyFriendships(i);n.send(a)},createFriendship:async function(e,n){const i=e.sanitize(e.body.friendName),c=new s(t),o=await c.getUserIdByUsername(i);let d;if(!o.length)return n.send({message:"User not found."});d=o[0].user_id;const p=e.session.userInfo.userId,u=a({userId:p,friendId:d,status1:"pending-sent",status2:"pending-received"}),m=new r(t);if((await m.checkIfBlockedBy(p,d)).length)return n.send({message:"User not found."});const l=await m.getFriendshipByFriendId(p,d);if(l.length){if("pending-sent"===l[0].status)return n.send({message:"Already sent."});if("pending-received"===l[0].status)return n.send({message:"Already received."});if("accepted"===l[0].status)return n.send({message:"Already friends."});if("blocked"===l[0].status)return n.send({message:"User blocked. First unblock."})}await m.createFriendship(u),n.send({message:"Friendship request sent."})},acceptFriendship:async function(e,n){const i=e.sanitize(e.body.friendName),a=new s(t),c=await a.getUserIdByUsername(i);let o;if(!c.length)return n.send({message:"User not found."});o=c[0].user_id;const d=e.session.userInfo.userId,p=new r(t);await p.acceptFriendship(d,o),n.send({message:"Friendship request accepted."})},rejectFriendship:async function(e,n){const i=e.sanitize(e.body.friendName),a=new s(t),c=await a.getUserIdByUsername(i);let o;if(!c.length)return n.send({message:"User not found."});o=c[0].user_id;const d=e.session.userInfo.userId,p=new r(t);await p.rejectFriendship(d,o),n.send({message:"Friendship request rejected."})},deleteFriendship:async function(e,n){const i=e.sanitize(e.body.friendName),a=new s(t),c=await a.getUserIdByUsername(i);let o;if(!c.length)return n.send({message:"User not found."});o=c[0].user_id;const d=e.session.userInfo.userId,p=new r(t);await p.deleteFriendship(d,o),n.send({message:"No longer friends. Maybe again later."})},blockUser:async function(e,n){const i=e.sanitize(e.body.friendName),a=new s(t),c=await a.getUserIdByUsername(i);let o;if(!c.length)return n.send({message:"User not found."});o=c[0].user_id;const d=e.session.userInfo.userId,p=new r(t);await p.blockUser(d,o),n.send({message:"User blocked."})},unblockUser:async function(e,n){const i=e.sanitize(e.body.friendName),a=new s(t),c=await a.getUserIdByUsername(i);let o;if(!c.length)return n.send({message:"User not found."});o=c[0].user_id;const d=e.session.userInfo.userId,p=new r(t);await p.unblockUser(d,o),n.send({message:"User unblocked."})}};e.exports=c},function(e,n){e.exports=class{constructor(e){this.pool=e,this.getFriendshipByFriendId=this.getFriendshipByFriendId.bind(this),this.checkIfBlockedBy=this.checkIfBlockedBy.bind(this),this.viewAllMyFriendships=this.viewAllMyFriendships.bind(this),this.viewAllMyAcceptedFriendships=this.viewAllMyAcceptedFriendships.bind(this),this.viewAllMyBlockedUsers=this.viewAllMyBlockedUsers.bind(this),this.createFriendship=this.createFriendship.bind(this),this.acceptFriendship=this.acceptFriendship.bind(this),this.rejectFriendship=this.rejectFriendship.bind(this),this.deleteFriendship=this.deleteFriendship.bind(this),this.blockUser=this.blockUser.bind(this),this.unblockUser=this.unblockUser.bind(this)}async getFriendshipByFriendId(e,n){const[i]=await this.pool.execute("\n      SELECT user_id, friend_id, status\n      FROM nobsc_friendships\n      WHERE user_id = ? AND friend_id = ?\n    ",[e,n]);return i}async checkIfBlockedBy(e,n){const[i]=await this.pool.execute('\n      SELECT user_id, friend_id\n      FROM nobsc_friendships\n      WHERE user_id = ? AND friend_id = ? AND status = "blocked"\n    ',[n,e]);return i}async viewAllMyFriendships(e){const[n]=await this.pool.execute('\n      SELECT\n        u.user_id AS user_id,\n        u.username AS username,\n        u.avatar AS avatar,\n        f.status AS status\n      FROM nobsc_users u\n      INNER JOIN nobsc_friendships f ON u.user_id = f.friend_id\n      WHERE f.user_id = ? AND f.status IN ("accepted", "pending-received", "blocked")\n    ',[e]);return n}async viewAllMyAcceptedFriendships(e){const[n]=await this.pool.execute('\n      SELECT\n        u.user_id AS user_id,\n        u.username AS username,\n        u.avatar AS avatar,\n        f.status AS status\n      FROM nobsc_users u\n      INNER JOIN nobsc_friendships f ON u.user_id = f.friend_id\n      WHERE f.user_id = ? AND f.status = "accepted"\n    ',[e]);return n}async viewAllMyPendingFriendships(e){const[n]=await this.pool.execute('\n      SELECT\n        u.user_id AS user_id,\n        u.username AS username,\n        u.avatar AS avatar,\n        f.status AS status\n      FROM nobsc_users u\n      INNER JOIN nobsc_friendships f ON u.user_id = f.friend_id\n      WHERE f.user_id = ? AND f.status = "pending-received"\n    ',[e]);return n}async viewAllMyBlockedUsers(e){const[n]=await this.pool.execute('\n      SELECT\n        u.user_id AS user_id,\n        u.username AS username,\n        u.avatar AS avatar,\n        f.status AS status\n      FROM nobsc_users u\n      INNER JOIN nobsc_friendships f ON u.user_id = f.friend_id\n      WHERE f.user_id = ? AND f.status = "blocked"\n    ',[e]);return n}async createFriendship(e){const{userId:n,friendId:i,status1:t,status2:s}=e,r="\n      INSERT INTO nobsc_friendships (user_id, friend_id, status)\n      VALUES (?, ?, ?)\n    ",[a]=await this.pool.execute(r,[n,i,t]);return await this.pool.execute(r,[i,n,s]),a}async acceptFriendship(e,n){const[i]=await this.pool.execute('\n      UPDATE nobsc_friendships\n      SET status = "accepted"\n      WHERE user_id = ? AND friend_id = ? AND status = "pending-received"\n      LIMIT 1\n    ',[e,n]);return await this.pool.execute('\n      UPDATE nobsc_friendships\n      SET status = "accepted"\n      WHERE user_id = ? AND friend_id = ? AND status = "pending-sent"\n      LIMIT 1\n    ',[n,e]),i}async rejectFriendship(e,n){const i='\n      DELETE\n      FROM nobsc_friendships\n      WHERE user_id = ? AND friend_id = ? AND status != "blocked"\n      LIMIT 1\n    ',[t]=await this.pool.execute(i,[e,n]);return await this.pool.execute(i,[n,e]),t}async deleteFriendship(e,n){const i='\n      DELETE\n      FROM nobsc_friendships\n      WHERE user_id = ? AND friend_id = ? AND status != "blocked"\n      LIMIT 1\n    ',[t]=await this.pool.execute(i,[e,n]);return await this.pool.execute(i,[n,e]),t}async blockUser(e,n){const i="\n      DELETE\n      FROM nobsc_friendships\n      WHERE user_id = ? AND friend_id = ?\n      LIMIT 1\n    ";await this.pool.execute(i,[e,n]),await this.pool.execute(i,[n,e]);const[t]=await this.pool.execute('\n      INSERT INTO nobsc_friendships (user_id, friend_id, status)\n      VALUES (?, ?, "blocked")\n    ',[e,n]);return t}async unblockUser(e,n){const[i]=await this.pool.execute("\n      DELETE\n      FROM nobsc_friendships\n      WHERE user_id = ? AND friend_id = ?\n      LIMIT 1\n    ",[e,n]);return i}}},function(e,n,i){const{struct:t}=i(2),s=t({userId:"number",friendId:"number",status1:"string",status2:"string"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(118),c=t();c.post("/",s,r(a.viewMyFavoriteRecipes)),c.post("/create",s,r(a.createMyFavoriteRecipe)),c.delete("/delete",s,r(a.deleteMyFavoriteRecipe)),e.exports=c},function(e,n,i){const t=i(3),s=i(9),r=i(119),a={viewMyFavoriteRecipes:async function(e,n){const i=e.session.userInfo.userId,r=new s(t),a=await r.viewMyFavoriteRecipes(i);n.send(a)},createMyFavoriteRecipe:async function(e,n){const i=e.session.userInfo.userId,a=Number(e.sanitize(e.body.recipeId));r({userId:i,recipeId:a});const c=new s(t);await c.createMyFavoriteRecipe(i,a),n.send({message:"Favorited."})},deleteMyFavoriteRecipe:async function(e,n){const i=e.session.userInfo.userId,a=Number(e.sanitize(e.body.recipeId));r({userId:i,recipeId:a});const c=new s(t);await c.deleteMyFavoriteRecipe(i,a),n.send({message:"Unfavorited."})}};e.exports=a},function(e,n,i){const{struct:t}=i(2),s=t({userId:"number",recipeId:"number"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(121),c=t();c.post("/",s,r(a.viewMySavedRecipes)),c.post("/create",s,r(a.createMySavedRecipe)),c.delete("/delete",s,r(a.deleteMySavedRecipe)),e.exports=c},function(e,n,i){const t=i(3),s=i(22),r=i(122),a={viewMySavedRecipes:async function(e,n){const i=e.session.userInfo.userId,r=new s(t),a=await r.viewMySavedRecipes(i);n.send(a)},createMySavedRecipe:async function(e,n){const i=e.session.userInfo.userId,a=Number(e.sanitize(e.body.recipeId));r({userId:i,recipeId:a});const c=new s(t);await c.createMySavedRecipe(i,a),n.send({message:"Saved."})},deleteMySavedRecipe:async function(e,n){const i=e.session.userInfo.userId,a=Number(e.sanitize(e.body.recipeId));r({userId:i,recipeId:a});const c=new s(t);await c.deleteMySavedRecipe(i,a),n.send({message:"Unsaved."})}};e.exports=a},function(e,n,i){const{struct:t}=i(2),s=t({userId:"number",recipeId:"number"});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(124),c=t();c.post("/all",s,r(a.viewAllMyPrivatePlans)),c.post("/one",s,r(a.viewMyPrivatePlan)),c.post("/create",s,r(a.createMyPrivatePlan)),c.put("/update",s,r(a.updateMyPrivatePlan)),c.delete("/delete",s,r(a.deleteMyPrivatePlan)),e.exports=c},function(e,n,i){const t=i(3),s=i(125),r=i(126),a={viewAllMyPrivatePlans:async function(e,n){const i=e.session.userInfo.userId,r=new s(t),a=await r.viewAllMyPrivatePlans(i);n.send(a)},viewMyPrivatePlan:async function(e,n){const i=Number(e.sanitize(e.body.planId)),r=e.session.userInfo.userId,a=new s(t),[c]=await a.viewMyPrivatePlan(r,i);n.send(c)},createMyPrivatePlan:async function(e,n){const i=e.sanitize(e.body.planInfo.planName),a=e.body.planInfo.planData,c=e.session.userInfo.userId,o=e.session.userInfo.userId,d=r({authorId:c,ownerId:o,planName:i,planData:a}),p=new s(t);await p.createMyPrivatePlan(d),n.send({message:"Plan created."})},updateMyPrivatePlan:async function(e,n){const i=Number(e.sanitize(e.body.planInfo.planId)),a=e.sanitize(e.body.planInfo.planName),c=e.body.planInfo.planData,o=e.session.userInfo.userId,d=e.session.userInfo.userId,p=r({authorId:o,ownerId:d,planName:a,planData:c}),u=new s(t);await u.updateMyPrivatePlan(p,i),n.send({message:"Plan updated."})},deleteMyPrivatePlan:async function(e,n){const i=Number(e.sanitize(e.body.planId)),r=e.session.userInfo.userId,a=new s(t);await a.deleteMyPrivatePlan(r,i),n.send({message:"Plan deleted."})}};e.exports=a},function(e,n){e.exports=class{constructor(e){this.pool=e,this.viewAllMyPrivatePlans=this.viewAllMyPrivatePlans.bind(this),this.viewMyPrivatePlan=this.viewMyPrivatePlan.bind(this),this.createMyPrivatePlan=this.createMyPrivatePlan.bind(this),this.updateMyPrivatePlan=this.updateMyPrivatePlan.bind(this),this.deleteMyPrivatePlan=this.deleteMyPrivatePlan.bind(this)}async viewAllMyPrivatePlans(e){const[n]=await this.pool.execute("\n      SELECT plan_id, plan_name, plan_data\n      FROM nobsc_plans\n      WHERE owner_id = ?\n    ",[e]);return n}async viewMyPrivatePlan(e,n){const[i]=await this.pool.execute("\n      SELECT plan_id, plan_name, plan_data\n      FROM nobsc_plans\n      WHERE owner_id = ? AND plan_id = ?\n    ",[e,n]);return i}async createMyPrivatePlan(e){const{authorId:n,ownerId:i,planName:t,planData:s}=e,[r]=await this.pool.execute("\n      INSERT INTO nobsc_plans (author_id, owner_id, plan_name, plan_data)\n      VALUES (?, ?, ?, ?)\n    ",[n,i,t,s]);return r}async updateMyPrivatePlan(e,n){const{planName:i,planData:t,ownerId:s}=e,[r]=await this.pool.execute("\n      UPDATE nobsc_plans\n      SET plan_name = ?, plan_data = ?\n      WHERE owner_id = ? AND plan_id = ?\n      LIMIT 1\n    ",[i,t,s,n]);return r}async deleteMyPrivatePlan(e,n){const[i]=await this.pool.execute("\n      DELETE\n      FROM nobsc_plans\n      WHERE owner_id = ? AND plan_id = ?\n      LIMIT 1\n    ",[e,n]);return i}}},function(e,n,i){const{struct:t}=i(2),s=t({authorId:"number",ownerId:"number",planName:"string",planData:"string"},{planData:JSON.stringify({1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:[],13:[],14:[],15:[],16:[],17:[],18:[],19:[],20:[],21:[],22:[],23:[],24:[],25:[],26:[],27:[],28:[]})});e.exports=s},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(128),c=t();c.post("/all",s,r(a.viewAllMyPrivateUserEquipment)),c.post("/one",s,r(a.viewMyPrivateUserEquipment)),c.post("/create",s,r(a.createMyPrivateUserEquipment)),c.put("/update",s,r(a.updateMyPrivateUserEquipment)),c.delete("/delete",s,r(a.deleteMyPrivateUserEquipment)),e.exports=c},function(e,n,i){const t=i(3),s=i(13),r=i(11),a=i(18),c={viewAllMyPrivateUserEquipment:async function(e,n){const i=e.session.userInfo.userId,s=new r(t),a=await s.viewAllMyPrivateUserEquipment(i);n.send(a)},viewMyPrivateUserEquipment:async function(e,n){const i=Number(e.sanitize(e.body.equipmentId)),s=e.session.userInfo.userId,a=new r(t),[c]=await a.viewMyPrivateUserEquipment(s,i);n.send(c)},createMyPrivateUserEquipment:async function(e,n){const i=Number(e.sanitize(e.body.equipmentInfo.equipmentTypeId)),s=e.sanitize(e.body.equipmentInfo.equipmentName),c=e.sanitize(e.body.equipmentInfo.equipmentDescription),o=e.sanitize(e.body.equipmentInfo.equipmentImage),d=e.session.userInfo.userId,p=e.session.userInfo.userId,u=a({equipmentTypeId:i,authorId:d,ownerId:p,equipmentName:s,equipmentDescription:c,equipmentImage:o}),m=new r(t);await m.createMyPrivateUserEquipment(u),n.send({message:"Equipment created."})},updateMyPrivateUserEquipment:async function(e,n){const i=Number(e.sanitize(e.body.equipmentInfo.equipmentId)),s=Number(e.sanitize(e.body.equipmentInfo.equipmentTypeId)),c=e.sanitize(e.body.equipmentInfo.equipmentName),o=e.sanitize(e.body.equipmentInfo.equipmentDescription),d=e.sanitize(e.body.equipmentInfo.equipmentImage),p=e.session.userInfo.userId,u=e.session.userInfo.userId,m=a({equipmentTypeId:s,authorId:p,ownerId:u,equipmentName:c,equipmentDescription:o,equipmentImage:d}),l=new r(t);await l.updateMyPrivateUserEquipment(m,i),n.send({message:"Equipment updated."})},deleteMyPrivateUserEquipment:async function(e,n){const i=Number(e.sanitize(e.body.equipmentId)),a=e.session.userInfo.userId,c=new s(t),o=new r(t);await c.deleteRecipeEquipmentByEquipmentId(i),await o.deleteMyPrivateUserEquipment(a,i),n.send({message:"Equipment deleted."})}};e.exports=c},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(130),c=t();c.post("/all",s,r(a.viewAllMyPrivateUserIngredients)),c.post("/one",s,r(a.viewMyPrivateUserIngredient)),c.post("/create",s,r(a.createMyPrivateUserIngredient)),c.put("/update",s,r(a.updateMyPrivateUserIngredient)),c.delete("/delete",s,r(a.deleteMyPrivateUserIngredient)),e.exports=c},function(e,n,i){const t=i(3),s=i(14),r=i(12),a=i(19),c={viewAllMyPrivateUserIngredients:async function(e,n){const i=e.session.userInfo.userId,s=new r(t),a=await s.viewAllMyPrivateUserIngredients(i);n.send(a)},viewMyPrivateUserIngredient:async function(e,n){const i=Number(e.sanitize(e.body.ingredientId)),s=e.session.userInfo.userId,a=new r(t),[c]=await a.viewMyPrivateUserIngredient(s,i);n.send(c)},createMyPrivateUserIngredient:async function(e,n){const i=Number(e.sanitize(e.body.ingredientInfo.ingredientTypeId)),s=e.sanitize(e.body.ingredientInfo.ingredientName),c=e.sanitize(e.body.ingredientInfo.ingredientDescription),o=e.sanitize(e.body.ingredientInfo.ingredientImage),d=e.session.userInfo.userId,p=e.session.userInfo.userId,u=a({ingredientTypeId:i,authorId:d,ownerId:p,ingredientName:s,ingredientDescription:c,ingredientImage:o}),m=new r(t);await m.createMyPrivateUserIngredient(u),n.send({message:"Ingredient created."})},updateMyPrivateUserIngredient:async function(e,n){const i=Number(e.sanitize(e.body.ingredientInfo.ingredientId)),s=Number(e.sanitize(e.body.ingredientInfo.ingredientTypeId)),c=e.sanitize(e.body.ingredientInfo.ingredientName),o=e.sanitize(e.body.ingredientInfo.ingredientDescription),d=e.sanitize(e.body.ingredientInfo.ingredientImage),p=e.session.userInfo.userId,u=e.session.userInfo.userId,m=a({ingredientTypeId:s,authorId:p,ownerId:u,ingredientName:c,ingredientDescription:o,ingredientImage:d}),l=new r(t);await l.updateMyPrivateUserIngredient(m,i),n.send({message:"Ingredient updated."})},deleteMyPrivateUserIngredient:async function(e,n){const i=Number(e.sanitize(e.body.ingredientId)),a=e.session.userInfo.userId,c=new s(t),o=new r(t);await c.deleteRecipeIngredientsByIngredientId(i),await o.deleteMyPrivateUserIngredient(a,i),n.send({message:"Ingredient deleted."})}};e.exports=c},function(e,n,i){const{Router:t}=i(0),s=i(4),r=i(1),a=i(132),c=t();c.post("/create",s,r(a.createRecipe)),c.put("/update",s,r(a.updateMyUserRecipe)),c.delete("/delete/private",s,r(a.deleteMyPrivateUserRecipe)),c.delete("/disown/public",s,r(a.disownMyPublicUserRecipe)),c.post("/private/all",s,r(a.viewAllMyPrivateUserRecipes)),c.post("/public/all",s,r(a.viewAllMyPublicUserRecipes)),c.post("/private/one",s,r(a.viewMyPrivateUserRecipe)),c.post("/public/one",s,r(a.viewMyPublicUserRecipe)),c.post("/edit/private",s,r(a.getInfoToEditMyPrivateUserRecipe)),c.post("/edit/public",s,r(a.getInfoToEditMyPublicUserRecipe)),e.exports=c},function(e,n,i){const t=i(3),s=i(28),r=i(8),a=i(20),c=i(13),o=i(14),d=i(21),p=i(29),u=i(23),m=i(24),l=i(25),I=i(26),_=i(27),y={viewAllMyPrivateUserRecipes:async function(e,n){const i=e.session.userInfo.userId,s=new r(t),a=await s.viewAllMyPrivateUserRecipes(i);n.send(a)},viewAllMyPublicUserRecipes:async function(e,n){const i=e.session.userInfo.userId,s=new r(t),a=await s.viewAllMyPublicUserRecipes(i,1);n.send(a)},viewMyPrivateUserRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeId)),s=e.session.userInfo.userId,a=new r(t),c=await a.viewMyPrivateUserRecipe(i,s);n.send(c)},viewMyPublicUserRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeId)),s=e.session.userInfo.userId,a=new r(t),[c]=await a.viewMyPublicUserRecipe(i,s,1);n.send(c)},getInfoToEditMyPrivateUserRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeId)),s=e.session.userInfo.userId,a=e.session.userInfo.userId,c=new r(t),o=await c.getInfoToEditMyUserRecipe(i,s,a);n.send(o)},getInfoToEditMyPublicUserRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeId)),s=e.session.userInfo.userId,a=new r(t),c=await a.getInfoToEditMyUserRecipe(i,s,1);n.send(c)},createRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeInfo.recipeTypeId)),y=Number(e.sanitize(e.body.recipeInfo.cuisineId)),g=e.sanitize(e.body.recipeInfo.title),h=e.sanitize(e.body.recipeInfo.description),E=e.sanitize(e.body.recipeInfo.directions),f=e.body.recipeInfo.requiredMethods,w=e.body.recipeInfo.requiredEquipment,b=e.body.recipeInfo.requiredIngredients,R=e.body.recipeInfo.requiredSubrecipes,N=e.sanitize(e.body.recipeInfo.recipeImage),v=e.sanitize(e.body.recipeInfo.recipeEquipmentImage),S=e.sanitize(e.body.recipeInfo.recipeIngredientsImage),q=e.sanitize(e.body.recipeInfo.recipeCookingImage),A=e.session.userInfo.userId,T="private"===e.sanitize(e.body.recipeInfo.ownership)?e.session.userInfo.userId:1,O=u({recipeTypeId:i,cuisineId:y,authorId:A,ownerId:T,title:g,description:h,directions:E,recipeImage:N,equipmentImage:v,ingredientsImage:S,cookingImage:q}),M=new r(t),x=(await M.createRecipe(O)).insertId;if("none"!==f&&f.length>0&&f.map(e=>m({recipeId:x,methodId:e.methodId}))){let e=[];f.map(n=>{e.push(x,n.methodId)});const n="(?, ?),".repeat(f.length).slice(0,-1),i=new a(t);await i.createRecipeMethods(e,n)}if("none"!==w&&w.length>0&&w.map(e=>l({recipeId:x,equipmentId:e.equipment,amount:e.amount}))){let e=[];w.map(n=>{e.push(x,n.equipment,n.amount)});const n="(?, ?, ?),".repeat(w.length).slice(0,-1),i=new c(t);await i.createRecipeEquipment(e,n)}if("none"!==b&&b.length>0&&b.map(e=>I({recipeId:x,ingredientId:e.ingredient,amount:e.amount,measurementId:e.unit}))){let e=[];b.map(n=>{e.push(x,n.ingredient,n.amount,n.unit)});const n="(?, ?, ?, ?),".repeat(b.length).slice(0,-1),i=new o(t);await i.createRecipeIngredients(e,n)}if("none"!==R&&R.length>0&&R.map(e=>_({recipeId:x,subrecipeId:e.subrecipe,amount:e.amount,measurementId:e.unit}))){let e=[];R.map(n=>{e.push(x,n.subrecipe,n.amount,n.unit)});const n="(?, ?, ?, ?),".repeat(R.length).slice(0,-1),i=new d(t);await i.createRecipeSubrecipes(e,n)}if(1===T){const e=await M.getPublicRecipeForElasticSearchInsert(x),n=new p(s);await n.saveRecipe(e)}n.send({message:"Recipe created."})},updateMyUserRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeInfo.recipeId)),y=Number(e.sanitize(e.body.recipeInfo.recipeTypeId)),g=Number(e.sanitize(e.body.recipeInfo.cuisineId)),h=e.sanitize(e.body.recipeInfo.title),E=e.sanitize(e.body.recipeInfo.description),f=e.sanitize(e.body.recipeInfo.directions),w=e.body.recipeInfo.requiredMethods,b=e.body.recipeInfo.requiredEquipment,R=e.body.recipeInfo.requiredIngredients,N=e.body.recipeInfo.requiredSubrecipes,v=e.sanitize(e.body.recipeInfo.recipeImage),S=e.sanitize(e.body.recipeInfo.recipeEquipmentImage),q=e.sanitize(e.body.recipeInfo.recipeIngredientsImage),A=e.sanitize(e.body.recipeInfo.recipeCookingImage),T=e.session.userInfo.userId,O="private"===e.sanitize(e.body.recipeInfo.ownership)?e.session.userInfo.userId:1;if(""==i||void 0===i)return n.send({message:"Invalid recipe ID!"});const M=u({recipeTypeId:y,cuisineId:g,authorId:T,ownerId:O,title:h,description:E,directions:f,recipeImage:v,equipmentImage:S,ingredientsImage:q,cookingImage:A}),x=new r(t);await x.updateMyUserRecipe(M,i);let U="none";"none"!==w&&w.map(e=>m({recipeId:i,methodId:e.methodId}))&&(U=[],w.map(e=>{U.push(i,e.methodId)}));const P="none"!==w?"(?, ?),".repeat(w.length).slice(0,-1):"none",C=new a(t);await C.updateRecipeMethods(U,P,i);let F="none";"none"!==b&&b.map(e=>l({recipeId:i,equipmentId:e.equipment,amount:e.amount}))&&(F=[],b.map(e=>{F.push(i,e.equipment,e.amount)}));const B="none"!==b?"(?, ?, ?),".repeat(b.length).slice(0,-1):"none",D=new c(t);await D.updateRecipeEquipment(F,B,i);let L="none";"none"!==R&&R.map(e=>I({recipeId:i,ingredientId:e.ingredient,amount:e.amount,measurementId:e.unit}))&&(L=[],R.map(e=>{L.push(i,e.ingredient,e.amount,e.unit)}));const z="none"!==R?"(?, ?, ?, ?),".repeat(R.length).slice(0,-1):"none",W=new o(t);await W.updateRecipeIngredients(L,z,i);let H="none";"none"!==N&&N.map(e=>_({recipeId:i,subrecipeId:e.subrecipe,amount:e.amount,measurementId:e.unit}))&&(H=[],N.map(e=>{H.push(i,e.subrecipe,e.amount,e.unit)}));const k="none"!==N?"(?, ?, ?, ?),".repeat(N.length).slice(0,-1):"none",J=new d(t);if(await J.updateRecipeSubrecipes(H,k,i),1===O){const e=await x.getPublicRecipeForElasticSearchInsert(i),n=new p(s);await n.saveRecipe(e)}n.send({message:"Recipe updated."})},deleteMyPrivateUserRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeId)),s=e.session.userInfo.userId,p=e.session.userInfo.userId,u=new a(t),m=new c(t),l=new o(t),I=new d(t),_=new r(t);await u.deleteRecipeMethods(i),await m.deleteRecipeEquipment(i),await l.deleteRecipeIngredients(i),await I.deleteRecipeSubrecipes(i),await I.deleteRecipeSubrecipesBySubrecipeId(i),await _.deleteMyPrivateUserRecipe(i,s,p),n.send({message:"Recipe deleted."})},disownMyPublicUserRecipe:async function(e,n){const i=Number(e.sanitize(e.body.recipeId)),a=e.session.userInfo.userId,c=new r(t);await c.disownMyPublicUserRecipe(2,i,a);const o=await c.getPublicRecipeForElasticSearchInsert(generatedId),d=new p(s);await d.saveRecipe(o),n.send({message:"Recipe disowned."})}};e.exports=y},function(e,n){e.exports=require("@elastic/elasticsearch")},function(e,n,i){const{Router:t}=i(0),s=i(1),r=i(135),a=t();a.post("/autocomplete/all",s(r.autocompletePublicAll)),a.post("/find/all",s(r.findPublicAll)),a.post("/autocomplete/recipes",s(r.autocompletePublicRecipes)),a.post("/find/recipes",s(r.findPublicRecipes)),a.post("/autocomplete/ingredients",s(r.autocompletePublicIngredients)),a.post("/find/ingredients",s(r.findPublicIngredients)),a.post("/autocomplete/equipment",s(r.autocompletePublicEquipment)),a.post("/find/equipment",s(r.findPublicEquipment)),e.exports=a},function(e,n,i){const t=i(28),s=i(136),r=i(29),a=i(137),c=i(138),o={autocompletePublicAll:async function(e,n){const i=e.sanitize(e.body.searchTerm),r=new s(t),a=await r.autoAll(i);return n.json({found:a})},findPublicAll:async function(e,n){const i=e.body.body,r=new s(t),a=await r.findAll(i);return n.json({found:a})},autocompletePublicRecipes:async function(e,n){const i=e.sanitize(e.body.searchTerm),s=new r(t),a=await s.autoRecipes(i);return n.json({found:a})},findPublicRecipes:async function(e,n){const i=e.body.body,s=new r(t),a=await s.findRecipes(i);return n.json({found:a})},autocompletePublicIngredients:async function(e,n){const i=e.sanitize(e.body.searchTerm),s=new a(t),r=await s.autoIngredients(i);return n.json({found:r})},findPublicIngredients:async function(e,n){const i=e.body.body,s=new a(t),r=await s.findIngredients(i);return n.json({found:r})},autocompletePublicEquipment:async function(e,n){const i=e.sanitize(e.body.searchTerm),s=new c(t),r=await s.autoEquipment(i);return n.json({found:r})},findPublicEquipment:async function(e,n){const i=e.body.body,s=new c(t),r=await s.findEquipment(i);return n.json({found:r})}};e.exports=o},function(e,n){e.exports=class{constructor(e){this.client=e,this.findAll=this.findAll.bind(this),this.autoAll=this.autoAll.bind(this)}async findAll(e){const{body:n}=await this.client.search({index:"_all",body:e});return n}async autoAll(e){const{body:n}=await this.client.search({index:"_all",body:{highlight:{fragment_size:200,number_of_fragments:1,fields:{title:{}}},query:{bool:{should:[{match:{title:{query:e,operator:"and"}}},{match:{ingredientName:{query:e,operator:"and"}}}]}}},from:0,size:5});return n}}},function(e,n){e.exports=class{constructor(e){this.client=e,this.findIngredients=this.findIngredients.bind(this),this.autoIngredients=this.autoIngredients.bind(this),this.saveIngredient=this.saveIngredient.bind(this),this.deleteIngredient=this.deleteIngredient.bind(this)}async findIngredients(e){const{body:n}=await this.client.search({index:"ingredients",body:e});return n}async autoIngredients(e){const{body:n}=await this.client.search({index:"ingredients",body:{highlight:{fragment_size:200,number_of_fragments:1,fields:{ingredientName:{}}},query:{bool:{must:[{match:{ingredientName:{query:e,operator:"and"}}}]}}},from:0,size:5});return n}async saveIngredient(e){const{ingredientId:n,ingredientTypeName:i,ingredientName:t,ingredientImage:s}=e,r=await this.client.index({index:"ingredients",id:n,body:{ingredientId:n,ingredientTypeName:i,ingredientName:t,ingredientImage:s}});return await this.client.indices.refresh({index:"ingredients"}),r}async deleteIngredient(e){const n=await this.client.delete({index:"ingredients",id:e},{ignore:[404]});return await this.client.indices.refresh({index:"ingredients"}),n}}},function(e,n){e.exports=class{constructor(e){this.client=e,this.findEquipment=this.findEquipment.bind(this),this.autoEquipment=this.autoEquipment.bind(this),this.saveEquipment=this.saveEquipment.bind(this),this.deleteEquipment=this.deleteEquipment.bind(this)}async findEquipment(e){const{body:n}=await this.client.search({index:"equipment",body:e});return n}async autoEquipment(e){const{body:n}=await this.client.search({index:"equipment",body:{highlight:{fragment_size:200,number_of_fragments:1,fields:{equipmentName:{}}},query:{bool:{must:[{match:{equipmentName:{query:e,operator:"and"}}}]}}},from:0,size:5});return n}async saveEquipment(e){const{equipmentId:n,equipmentTypeName:i,equipmentName:t,equipmentImage:s}=e,r=await this.client.index({index:"equipment",id:n,body:{equipmentId:n,equipmentTypeName:i,equipmentName:t,equipmentImage:s}});return await this.client.indices.refresh({index:"equipment"}),r}async deleteEquipment(e){const n=await this.client.delete({index:"equipment",id:e},{ignore:[404]});return await this.client.indices.refresh({index:"equipment"}),n}}}]);